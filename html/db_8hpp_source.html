<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>sqlite_wrapper: E:/entwicklung/git/sqlite-wrapper/include/sqlite_wrapper/db.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>E:/entwicklung/git/sqlite-wrapper/include/sqlite_wrapper/db.hpp</h1><a href="db_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#ifndef db_h__</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#define db_h__</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00029"></a>00029 <span class="preprocessor">#if _MSC_VER &gt; 1000</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span><span class="preprocessor">#pragma once</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#endif // _MSC_VER &gt; 1000</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033 <span class="preprocessor">#pragma warning( push, 1 )</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="config_8hpp.html" title="This file is part of the sqlite-wrapper project.">config.hpp</a>&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;boost/detail/allocator_utilities.hpp&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;boost/detail/quick_allocator.hpp&gt;</span> 
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;boost/lexical_cast.hpp&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;boost/shared_ptr.hpp&gt;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;sqlite/sqlite3.h&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#pragma warning( pop )</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;detail/time.hpp&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;detail/tools.hpp&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;detail/param.hpp&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;detail/exception.hpp&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;detail/field.hpp&quot;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="keyword">namespace </span>db
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054     <span class="keyword">namespace </span>expr
<a name="l00055"></a>00055     {
<a name="l00056"></a>00056         <span class="keyword">class </span>base;
<a name="l00057"></a>00057         <span class="keyword">class </span>connective;
<a name="l00058"></a>00058         <span class="keyword">class </span>in;
<a name="l00059"></a>00059         <span class="keyword">class </span>and_;
<a name="l00060"></a>00060         <span class="keyword">class </span>or_;
<a name="l00061"></a>00061         <span class="keyword">class </span>not_;
<a name="l00062"></a>00062         <span class="keyword">class </span>not_eq_;
<a name="l00063"></a>00063         <span class="keyword">class </span>eq;
<a name="l00064"></a>00064         <span class="keyword">class </span>lt;
<a name="l00065"></a>00065         <span class="keyword">class </span>lt_eq;
<a name="l00066"></a>00066         <span class="keyword">class </span>gt;
<a name="l00067"></a>00067         <span class="keyword">class </span>gt_eq;
<a name="l00068"></a>00068         <span class="keyword">class </span>like;
<a name="l00069"></a>00069     }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071   <span class="keyword">class </span>row;
<a name="l00072"></a>00072   <span class="keyword">class </span>query;
<a name="l00073"></a>00073   <span class="keyword">class </span>base;
<a name="l00074"></a>00074     <span class="keyword">class </span>sel;
<a name="l00075"></a>00075   <span class="keyword">class </span>del;
<a name="l00076"></a>00076   <span class="keyword">class </span>ins;
<a name="l00077"></a>00077   <span class="keyword">class </span>upd;
<a name="l00078"></a>00078   <span class="keyword">class </span>field;
<a name="l00079"></a><a class="code" href="classdb_1_1field.html">00079</a> 
<a name="l00081"></a>00081     <span class="keyword">class </span><a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> 
<a name="l00082"></a>00082     {
<a name="l00083"></a>00083     <span class="keyword">public</span>:
<a name="l00084"></a>00084         <span class="keyword">typedef</span> std::vector&lt; std::pair&lt;string, string&gt; &gt; Values;
<a name="l00085"></a>00085     <span class="keyword">protected</span>:
<a name="l00086"></a>00086         <span class="keywordtype">string</span> _name, _table, _sourcename;
<a name="l00087"></a>00087         param_types _type;
<a name="l00088"></a>00088         <span class="keywordtype">unsigned</span> _extra;
<a name="l00089"></a>00089         Values _values;
<a name="l00090"></a>00090         <span class="keywordtype">long</span> _length;
<a name="l00091"></a>00091     <span class="keyword">public</span>:
<a name="l00103"></a>00103         <span class="keyword">explicit</span> <a class="code" href="classdb_1_1field.html#ab16b4a8af56fd44adb84a6e301d89f51" title="field">field</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; n, 
<a name="l00104"></a>00104             <span class="keyword">const</span> param_types&amp; t=e_long)
<a name="l00105"></a>00105             : _name(n), _type(t), _extra(e_nullExtra), _length(-1) {}
<a name="l00106"></a>00106 
<a name="l00117"></a>00117         <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00118"></a>00118         <span class="keyword">explicit</span> <a class="code" href="classdb_1_1field.html#ab16b4a8af56fd44adb84a6e301d89f51" title="field">field</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; n, <span class="keyword">const</span> T&amp; val)
<a name="l00119"></a>00119             : _name(n), _type(tp(val)), _extra(e_nullExtra), _length(-1) 
<a name="l00120"></a>00120         {
<a name="l00121"></a>00121             _values.push_back(Values::value_type(n, detail::to_string(val))); 
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123 
<a name="l00136"></a>00136         <span class="keyword">explicit</span> <a class="code" href="classdb_1_1field.html#ab16b4a8af56fd44adb84a6e301d89f51" title="field">field</a>(<span class="keyword">const</span> string_pair&amp; n_tbl,
<a name="l00137"></a>00137             <span class="keyword">const</span> param_types&amp; t=e_long, 
<a name="l00138"></a>00138             <span class="keyword">const</span> Values&amp; vals = Values())
<a name="l00139"></a>00139             : _name(n_tbl.first), _type(t), _table(n_tbl.second), _values(vals), 
<a name="l00140"></a>00140             _extra(e_nullExtra), _length(-1) {}
<a name="l00141"></a>00141 
<a name="l00152"></a>00152         <a class="code" href="classdb_1_1field.html#ab16b4a8af56fd44adb84a6e301d89f51" title="field">field</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a>&amp; f)
<a name="l00153"></a>00153             : _name(f._name), _type(f._type), _table(f._table), _values(f._values), 
<a name="l00154"></a>00154             _extra(f._extra), _length(f._length) {}
<a name="l00155"></a>00155 
<a name="l00164"></a>00164         <a class="code" href="classdb_1_1field.html#ab16b4a8af56fd44adb84a6e301d89f51" title="field">field</a>() : _type(e_long), _extra(e_nullExtra), _length(-1) {}
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         <span class="keywordtype">string</span> fullName()<span class="keyword"> const </span>{ 
<a name="l00167"></a>00167             <span class="keywordflow">if</span> (table().length()&gt;0) 
<a name="l00168"></a>00168                 <span class="keywordflow">return</span>  table() + DB_TEXT(<span class="stringliteral">&quot;.&quot;</span>) + name(); 
<a name="l00169"></a>00169             <span class="keywordflow">else</span>
<a name="l00170"></a>00170                 <span class="keywordflow">return</span>  name(); }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172         ~<a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a>() {}
<a name="l00173"></a>00173 
<a name="l00174"></a>00174         <span class="keywordtype">string</span>      name()<span class="keyword">        const </span>{ <span class="keywordflow">return</span> _name; }
<a name="l00175"></a>00175         <span class="keywordtype">string</span>      sourcename()<span class="keyword">  const </span>{ <span class="keywordflow">return</span> _sourcename; }
<a name="l00176"></a>00176         param_types type()<span class="keyword">        const </span>{ <span class="keywordflow">return</span> _type; }
<a name="l00177"></a>00177         <span class="keywordtype">string</span>      table()<span class="keyword">       const </span>{ <span class="keywordflow">return</span> _table; }
<a name="l00178"></a>00178         <span class="keyword">const</span> <span class="keywordtype">long</span>&amp; length()<span class="keyword">      const </span>{ <span class="keywordflow">return</span> _length; }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a>&amp;      set_type(param_types type) { _type = type; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00181"></a>00181         <span class="keywordtype">void</span>        set_table(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; table) { _table = table; }
<a name="l00182"></a>00182         <span class="keywordtype">void</span>        set_sourcename(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; sourcename) 
<a name="l00183"></a>00183         {_sourcename = sourcename;}
<a name="l00184"></a>00184         <span class="keywordtype">void</span>        set_length(<span class="keyword">const</span> <span class="keywordtype">long</span>&amp; len) { _length = len; }
<a name="l00185"></a>00185         <span class="keywordtype">bool</span>        has_extra(field_extra extra)<span class="keyword"> const </span>
<a name="l00186"></a>00186 <span class="keyword">        </span>{ <span class="keywordflow">return</span> ((_extra&amp;extra)==1); }
<a name="l00187"></a>00187         <span class="keywordtype">void</span>        add_extra(field_extra extra) { 
<a name="l00188"></a>00188             <span class="keywordflow">if</span>(!(_extra&amp;extra)) 
<a name="l00189"></a>00189                 _extra |= extra; 
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191         <span class="keywordtype">void</span>        remove_extra(field_extra extra) { 
<a name="l00192"></a>00192             <span class="keywordflow">if</span>(_extra&amp;extra) 
<a name="l00193"></a>00193                 _extra &amp;= ~extra; 
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195 
<a name="l00204"></a>00204         Values&amp; <a class="code" href="classdb_1_1field.html#abd933ffca0d086a69e0024bc72da5229" title="values">values</a>() { <span class="keywordflow">return</span> _values; }
<a name="l00205"></a>00205 
<a name="l00214"></a>00214         <span class="keyword">const</span> Values&amp; <a class="code" href="classdb_1_1field.html#abd933ffca0d086a69e0024bc72da5229" title="values">values</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _values; }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <a class="code" href="classdb_1_1expr_1_1in.html" title="in Operator">expr::in</a> <a class="code" href="classdb_1_1field.html#a2916ac60c608a1a023b91df8fb1af67b" title="syntactic sugar to expression-api, field.in(sel)">In</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; <span class="keyword">set</span>) <span class="keyword">const</span>;
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         <a class="code" href="classdb_1_1expr_1_1in.html" title="in Operator">expr::in</a> <a class="code" href="classdb_1_1field.html#a2916ac60c608a1a023b91df8fb1af67b" title="syntactic sugar to expression-api, field.in(sel)">In</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a>&amp; <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a>) <span class="keyword">const</span>;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220         <a class="code" href="classdb_1_1expr_1_1like.html" title="like operator">expr::like</a> <a class="code" href="classdb_1_1field.html#a045f9b5ad7b586e91e874d0358cee06f" title="syntactic sugar to expression-api, field.like(string)">Like</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222         <span class="keywordtype">bool</span> operator==(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fd)<span class="keyword"> const </span>
<a name="l00223"></a>00223 <span class="keyword">        </span>{
<a name="l00224"></a>00224             <span class="keywordflow">return</span> fd.fullName() == fullName();
<a name="l00225"></a>00225         }
<a name="l00226"></a>00226         <span class="keywordtype">bool</span> operator!=(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fd)<span class="keyword"> const </span>
<a name="l00227"></a>00227 <span class="keyword">        </span>{
<a name="l00228"></a>00228             <span class="keywordflow">return</span> ! (*<span class="keyword">this</span> == fd);
<a name="l00229"></a>00229         }
<a name="l00230"></a>00230     };
<a name="l00231"></a>00231     <span class="keyword">typedef</span> boost::detail::allocator::partial_std_allocator_wrapper&lt;
<a name="l00232"></a>00232         boost::detail::quick_allocator&lt;field &gt; &gt; alloc_field; 
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     <span class="keyword">typedef</span> std::pair&lt;field, field&gt; field_pair;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236   <span class="keyword">namespace </span>expr
<a name="l00237"></a><a class="code" href="classdb_1_1expr_1_1base.html">00237</a>   {
<a name="l00239"></a>00239     <span class="keyword">class </span><a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">base</a> 
<a name="l00240"></a><a class="code" href="classdb_1_1expr_1_1base.html#a689c657a829e9f574300b1bac772e2aa">00240</a>     {
<a name="l00241"></a>00241     <span class="keyword">protected</span>:
<a name="l00242"></a>00242       split <a class="code" href="classdb_1_1expr_1_1base.html#a689c657a829e9f574300b1bac772e2aa" title="extra tables, to be joined">extraTables</a>; 
<a name="l00243"></a>00243     <span class="keyword">public</span>:
<a name="l00244"></a>00244 
<a name="l00253"></a>00253       <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classdb_1_1expr_1_1base.html#aa44ea1ee8e44ece8ec2facb14c64456f" title="default expression is true">str</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>); }
<a name="l00254"></a>00254 
<a name="l00262"></a>00262       <span class="keyword">virtual</span> <a class="code" href="classdb_1_1expr_1_1base.html#aaa64a5187f0bc6f4f93406a7db0669d2" title="operator string">operator string</a>()<span class="keyword"> const</span>
<a name="l00263"></a>00263 <span class="keyword">      </span>{ <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1base.html#aa44ea1ee8e44ece8ec2facb14c64456f" title="default expression is true">str</a>(); }
<a name="l00264"></a>00264 
<a name="l00271"></a>00271       split <a class="code" href="classdb_1_1expr_1_1base.html#ac60b7f9172c42cb07713765df7c8052a">getExtraTables</a>()<span class="keyword"> const </span>{ 
<a name="l00272"></a>00272         <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1base.html#a689c657a829e9f574300b1bac772e2aa" title="extra tables, to be joined">extraTables</a>;
<a name="l00273"></a>00273       }
<a name="l00274"></a>00274 
<a name="l00283"></a>00283       <span class="keyword">virtual</span> <a class="code" href="classdb_1_1expr_1_1base.html#a484c4ea40870731844ca189d6e7a3259" title="default virtual destructor">~base</a>() {}
<a name="l00284"></a>00284     }; 
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <span class="keyword">class </span>raw : <span class="keyword">public</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">base</a> 
<a name="l00287"></a>00287     {
<a name="l00288"></a>00288       <span class="keywordtype">string</span> expr;
<a name="l00289"></a>00289     <span class="keyword">public</span>:
<a name="l00299"></a>00299       <span class="keyword">explicit</span> raw(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; e) : expr(e) {}
<a name="l00300"></a>00300 
<a name="l00301"></a>00301       <span class="keyword">virtual</span> <span class="keywordtype">string</span> str()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> expr; }
<a name="l00302"></a>00302     };
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="keyword">class </span>connective : <span class="keyword">public</span> base 
<a name="l00305"></a>00305     {
<a name="l00306"></a>00306     <span class="keyword">private</span>:
<a name="l00307"></a>00307       <span class="keywordtype">string</span> op;
<a name="l00308"></a>00308     <span class="keyword">protected</span>:
<a name="l00309"></a>00309       <span class="keyword">const</span> base &amp;e1, &amp;e2;
<a name="l00310"></a>00310 
<a name="l00322"></a>00322       <span class="keyword">explicit</span> connective(<span class="keywordtype">string</span> o, <span class="keyword">const</span> base &amp; e1_, <span class="keyword">const</span> base &amp; e2_)
<a name="l00323"></a>00323         : op(o), e1(e1_), e2(e2_) { }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="keyword">public</span>:        
<a name="l00326"></a>00326 
<a name="l00335"></a>00335       <span class="keyword">virtual</span> <span class="keywordtype">string</span> str()<span class="keyword"> const </span>{
<a name="l00336"></a>00336         <span class="keywordtype">string</span> res = DB_TEXT(<span class="stringliteral">&quot;(&quot;</span>) + e1.str() + DB_TEXT(<span class="stringliteral">&quot;) &quot;</span>) + op 
<a name="l00337"></a>00337           + DB_TEXT(<span class="stringliteral">&quot; (&quot;</span>) + e2.str() + DB_TEXT(<span class="stringliteral">&quot;)&quot;</span>);
<a name="l00338"></a>00338         <span class="keywordflow">return</span> res;
<a name="l00339"></a>00339       }
<a name="l00340"></a>00340     };  
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     <span class="keyword">class </span>and_ : <span class="keyword">public</span> connective 
<a name="l00343"></a>00343     {
<a name="l00344"></a>00344     <span class="keyword">public</span>:
<a name="l00355"></a>00355       <span class="keyword">explicit</span> and_(<span class="keyword">const</span> base &amp; e1_, <span class="keyword">const</span> base &amp; e2_) : 
<a name="l00356"></a>00356                 connective(DB_TEXT(<span class="stringliteral">&quot;and&quot;</span>), e1_, e2_) {}
<a name="l00357"></a>00357 
<a name="l00366"></a>00366       <span class="keyword">virtual</span> <span class="keywordtype">string</span> str()<span class="keyword"> const </span>{     
<a name="l00367"></a>00367         <span class="keywordflow">if</span> (e1.str() == DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>))
<a name="l00368"></a>00368           <span class="keywordflow">return</span> e2.str();
<a name="l00369"></a>00369         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e2.str() == DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>))
<a name="l00370"></a>00370           <span class="keywordflow">return</span> e1.str();
<a name="l00371"></a>00371         <span class="keywordflow">else</span>
<a name="l00372"></a>00372           <span class="keywordflow">return</span> connective::str();
<a name="l00373"></a>00373       }
<a name="l00374"></a>00374     };
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     <span class="keyword">class </span>or_ : <span class="keyword">public</span> connective 
<a name="l00377"></a>00377     {
<a name="l00378"></a>00378     <span class="keyword">public</span>:
<a name="l00389"></a>00389       <span class="keyword">explicit</span> or_(<span class="keyword">const</span> base &amp; e1_, <span class="keyword">const</span> base &amp; e2_) 
<a name="l00390"></a>00390         : connective(DB_TEXT(<span class="stringliteral">&quot;or&quot;</span>), e1_, e2_) {}
<a name="l00391"></a>00391 
<a name="l00400"></a>00400       <span class="keyword">virtual</span> <span class="keywordtype">string</span> str()<span class="keyword"> const </span>{
<a name="l00401"></a>00401         <span class="keywordflow">if</span> (e1.str() == DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>))
<a name="l00402"></a>00402           <span class="keywordflow">return</span> DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>);
<a name="l00403"></a>00403         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e2.str() == DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>))
<a name="l00404"></a>00404           <span class="keywordflow">return</span> DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>);
<a name="l00405"></a>00405         <span class="keywordflow">else</span>
<a name="l00406"></a>00406           <span class="keywordflow">return</span> connective::str();
<a name="l00407"></a>00407       }
<a name="l00408"></a>00408     };
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <span class="keyword">class </span>not_ : <span class="keyword">public</span> base 
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412     <span class="keyword">private</span>:
<a name="l00413"></a>00413       <span class="keyword">const</span> base &amp; exp;
<a name="l00414"></a>00414     <span class="keyword">public</span>:
<a name="l00424"></a>00424       <span class="keyword">explicit</span> not_(<span class="keyword">const</span> base &amp; _exp) : exp(_exp) {}
<a name="l00425"></a>00425 
<a name="l00434"></a>00434       <span class="keyword">virtual</span> <span class="keywordtype">string</span> str()<span class="keyword"> const </span>{    
<a name="l00435"></a>00435         <span class="keywordflow">return</span> DB_TEXT(<span class="stringliteral">&quot;not (&quot;</span>)+exp.str()+DB_TEXT(<span class="stringliteral">&quot;)&quot;</span>);
<a name="l00436"></a>00436       }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438     };
<a name="l00439"></a><a class="code" href="classdb_1_1expr_1_1oper.html">00439</a> 
<a name="l00441"></a>00441     <span class="keyword">class </span><a class="code" href="classdb_1_1expr_1_1oper.html" title="base class for operators in sql terms">oper</a> : <span class="keyword">public</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">base</a> 
<a name="l00442"></a>00442     {
<a name="l00443"></a>00443     <span class="keyword">protected</span>:
<a name="l00444"></a>00444       <span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; _field;
<a name="l00445"></a>00445       <span class="keywordtype">string</span> op;
<a name="l00446"></a>00446       <span class="keywordtype">string</span> data;
<a name="l00447"></a>00447       <span class="keywordtype">bool</span> escape;
<a name="l00448"></a>00448 
<a name="l00459"></a>00459       <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classdb_1_1expr_1_1oper.html#a371752df8e9d8868798a148d8d392be4">check_escape</a>(<span class="keyword">const</span> param_types&amp; type_)
<a name="l00460"></a>00460       {
<a name="l00461"></a>00461         <span class="keywordflow">switch</span>(type_) 
<a name="l00462"></a>00462         {
<a name="l00463"></a>00463         <span class="keywordflow">case</span> e_string:
<a name="l00464"></a>00464         <span class="keywordflow">case</span> e_char:
<a name="l00465"></a>00465         <span class="keywordflow">case</span> e_blob:
<a name="l00466"></a>00466         <span class="keywordflow">case</span> e_date_time:
<a name="l00467"></a>00467           <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00468"></a>00468           <span class="keywordflow">break</span>;
<a name="l00469"></a>00469         <span class="keywordflow">default</span>:
<a name="l00470"></a>00470           <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472       }
<a name="l00473"></a>00473 
<a name="l00485"></a>00485       <span class="keyword">explicit</span> <a class="code" href="classdb_1_1expr_1_1oper.html#a48753e202440521e07b9509636195b84" title="string overload">oper</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; o, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; d) 
<a name="l00486"></a>00486         : _field(fld), op(o), data(d), escape(<a class="code" href="classdb_1_1expr_1_1oper.html#a371752df8e9d8868798a148d8d392be4">check_escape</a>(_field.type())) 
<a name="l00487"></a>00487       {
<a name="l00488"></a>00488         <a class="code" href="classdb_1_1expr_1_1base.html#a689c657a829e9f574300b1bac772e2aa" title="extra tables, to be joined">extraTables</a>.push_back(fld.table());
<a name="l00489"></a>00489       }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491       <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00492"></a>00492       <span class="keyword">explicit</span> <a class="code" href="classdb_1_1expr_1_1oper.html#a48753e202440521e07b9509636195b84" title="string overload">oper</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; o, <span class="keyword">const</span> T&amp; d) 
<a name="l00493"></a>00493         : _field(fld), op(o), data(DB_TEXT(<span class="stringliteral">&quot;0&quot;</span>)), 
<a name="l00494"></a>00494         escape(<a class="code" href="classdb_1_1expr_1_1oper.html#a371752df8e9d8868798a148d8d392be4">check_escape</a>(_field.type())) 
<a name="l00495"></a>00495       {
<a name="l00496"></a>00496         data = detail::to_string(d);
<a name="l00497"></a>00497         <a class="code" href="classdb_1_1expr_1_1base.html#a689c657a829e9f574300b1bac772e2aa" title="extra tables, to be joined">extraTables</a>.push_back(fld.table());
<a name="l00498"></a>00498       }
<a name="l00499"></a>00499 
<a name="l00511"></a>00511       <span class="keyword">explicit</span> <a class="code" href="classdb_1_1expr_1_1oper.html#a48753e202440521e07b9509636195b84" title="string overload">oper</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; o, <span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp;f2) 
<a name="l00512"></a>00512         : _field(fld), op(o), data(f2.fullName()), escape(<span class="keyword">false</span>) 
<a name="l00513"></a>00513       {
<a name="l00514"></a>00514         <a class="code" href="classdb_1_1expr_1_1base.html#a689c657a829e9f574300b1bac772e2aa" title="extra tables, to be joined">extraTables</a>.push_back(fld.table());
<a name="l00515"></a>00515       }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517     <span class="keyword">public</span>:
<a name="l00526"></a>00526       <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classdb_1_1expr_1_1oper.html#aedb58a87bb3785571d4cd2c012d7965c" title="str">str</a>()<span class="keyword"> const </span>{
<a name="l00527"></a>00527         <span class="keywordtype">string</span> res;
<a name="l00528"></a>00528         res += _field.fullName() + DB_TEXT(<span class="stringliteral">&quot; &quot;</span>) + op + DB_TEXT(<span class="stringliteral">&quot; &quot;</span>) + 
<a name="l00529"></a>00529           (escape ? detail::escape_sql(data) : data);
<a name="l00530"></a>00530         <span class="keywordflow">return</span> res;
<a name="l00531"></a>00531       }
<a name="l00532"></a>00532     };
<a name="l00533"></a><a class="code" href="classdb_1_1expr_1_1eq.html">00533</a> 
<a name="l00535"></a>00535     <span class="keyword">class </span><a class="code" href="classdb_1_1expr_1_1eq.html" title="==, is equal operator">eq</a> : <span class="keyword">public</span> <a class="code" href="classdb_1_1expr_1_1oper.html" title="base class for operators in sql terms">oper</a> {
<a name="l00536"></a>00536     <span class="keyword">public</span>:
<a name="l00547"></a>00547       <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00548"></a>00548       <span class="keyword">explicit</span> <a class="code" href="classdb_1_1expr_1_1eq.html#a4b81ca39235214e0a374f4dcf5b3c701" title="==, is equal operator">eq</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> T&amp; d)
<a name="l00549"></a>00549         : <a class="code" href="classdb_1_1expr_1_1oper.html#a48753e202440521e07b9509636195b84" title="string overload">oper</a>(fld, DB_TEXT(<span class="stringliteral">&quot;=&quot;</span>), d) 
<a name="l00550"></a>00550       {}
<a name="l00551"></a>00551     };
<a name="l00552"></a>00552 
<a name="l00554"></a>00554     <span class="keyword">class </span>not_eq_ : <span class="keyword">public</span> <a class="code" href="classdb_1_1expr_1_1oper.html" title="base class for operators in sql terms">oper</a> {
<a name="l00555"></a>00555     <span class="keyword">public</span>:
<a name="l00566"></a>00566       <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00567"></a>00567       <span class="keyword">explicit</span> not_eq_(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> T&amp; d)
<a name="l00568"></a>00568         : <a class="code" href="classdb_1_1expr_1_1oper.html" title="base class for operators in sql terms">oper</a>(fld, DB_TEXT(<span class="stringliteral">&quot;&lt;&gt;&quot;</span>), d) 
<a name="l00569"></a>00569       {}
<a name="l00570"></a>00570     };
<a name="l00571"></a><a class="code" href="classdb_1_1expr_1_1gt.html">00571</a> 
<a name="l00573"></a>00573     <span class="keyword">class </span><a class="code" href="classdb_1_1expr_1_1gt.html" title="&amp;gt; greater then operator">gt</a> : <span class="keyword">public</span> <a class="code" href="classdb_1_1expr_1_1oper.html" title="base class for operators in sql terms">oper</a> {
<a name="l00574"></a>00574     <span class="keyword">public</span>:
<a name="l00585"></a>00585       <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00586"></a>00586       <span class="keyword">explicit</span> <a class="code" href="classdb_1_1expr_1_1gt.html#a2f97395a43e96a2044802935435f0407" title="gt">gt</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> T&amp; d)
<a name="l00587"></a>00587         : <a class="code" href="classdb_1_1expr_1_1oper.html#a48753e202440521e07b9509636195b84" title="string overload">oper</a>(fld, DB_TEXT(<span class="stringliteral">&quot;&gt;&quot;</span>), d) 
<a name="l00588"></a>00588       {}
<a name="l00589"></a>00589     };
<a name="l00590"></a><a class="code" href="classdb_1_1expr_1_1gt__eq.html">00590</a> 
<a name="l00592"></a>00592     <span class="keyword">class </span><a class="code" href="classdb_1_1expr_1_1gt__eq.html" title="greater then or equal operator">gt_eq</a> : <span class="keyword">public</span> <a class="code" href="classdb_1_1expr_1_1oper.html" title="base class for operators in sql terms">oper</a> {
<a name="l00593"></a>00593     <span class="keyword">public</span>:
<a name="l00604"></a>00604       <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00605"></a>00605       <span class="keyword">explicit</span> <a class="code" href="classdb_1_1expr_1_1gt__eq.html#af34a49ff2f1b4800a97cc58b3bece6e0" title="gt_eq">gt_eq</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> T&amp; d)
<a name="l00606"></a>00606         : <a class="code" href="classdb_1_1expr_1_1oper.html#a48753e202440521e07b9509636195b84" title="string overload">oper</a>(fld, DB_TEXT(<span class="stringliteral">&quot;&gt;=&quot;</span>), d) 
<a name="l00607"></a>00607       {}
<a name="l00608"></a>00608     };
<a name="l00609"></a><a class="code" href="classdb_1_1expr_1_1lt.html">00609</a> 
<a name="l00611"></a>00611     <span class="keyword">class </span><a class="code" href="classdb_1_1expr_1_1lt.html" title="lower then operator">lt</a> : <span class="keyword">public</span> <a class="code" href="classdb_1_1expr_1_1oper.html" title="base class for operators in sql terms">oper</a> {
<a name="l00612"></a>00612     <span class="keyword">public</span>:
<a name="l00623"></a>00623       <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00624"></a>00624       <span class="keyword">explicit</span> <a class="code" href="classdb_1_1expr_1_1lt.html#ae725636dd9447296d3a599bc386b06c8" title="lt">lt</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> T&amp; d)
<a name="l00625"></a>00625         : <a class="code" href="classdb_1_1expr_1_1oper.html#a48753e202440521e07b9509636195b84" title="string overload">oper</a>(fld, DB_TEXT(<span class="stringliteral">&quot;&lt;&quot;</span>), d) 
<a name="l00626"></a>00626       {}
<a name="l00627"></a>00627     };
<a name="l00628"></a><a class="code" href="classdb_1_1expr_1_1lt__eq.html">00628</a> 
<a name="l00630"></a>00630     <span class="keyword">class </span><a class="code" href="classdb_1_1expr_1_1lt__eq.html" title="lower then or equal operator">lt_eq</a> : <span class="keyword">public</span> <a class="code" href="classdb_1_1expr_1_1oper.html" title="base class for operators in sql terms">oper</a> {
<a name="l00631"></a>00631     <span class="keyword">public</span>:
<a name="l00642"></a>00642       <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00643"></a>00643       <span class="keyword">explicit</span> <a class="code" href="classdb_1_1expr_1_1lt__eq.html#a1b064f9a79246850d1d6875396c2d0a6" title="lt_eq">lt_eq</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> T&amp; d)
<a name="l00644"></a>00644         : <a class="code" href="classdb_1_1expr_1_1oper.html#a48753e202440521e07b9509636195b84" title="string overload">oper</a>(fld, DB_TEXT(<span class="stringliteral">&quot;&lt;=&quot;</span>), d) 
<a name="l00645"></a>00645       {}
<a name="l00646"></a>00646     };
<a name="l00647"></a><a class="code" href="classdb_1_1expr_1_1like.html">00647</a> 
<a name="l00649"></a>00649     <span class="keyword">class </span><a class="code" href="classdb_1_1expr_1_1like.html" title="like operator">like</a> : <span class="keyword">public</span> <a class="code" href="classdb_1_1expr_1_1oper.html" title="base class for operators in sql terms">oper</a> {
<a name="l00650"></a>00650     <span class="keyword">public</span>:
<a name="l00661"></a>00661       <span class="keyword">explicit</span> <a class="code" href="classdb_1_1expr_1_1like.html#a81e4485fec0292cb641cc840d03e25bb" title="like">like</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; d)
<a name="l00662"></a>00662         : <a class="code" href="classdb_1_1expr_1_1oper.html#a48753e202440521e07b9509636195b84" title="string overload">oper</a>(fld, DB_TEXT(<span class="stringliteral">&quot;LIKE&quot;</span>), d) 
<a name="l00663"></a>00663       {}
<a name="l00664"></a>00664     };
<a name="l00665"></a><a class="code" href="classdb_1_1expr_1_1in.html">00665</a> 
<a name="l00667"></a>00667     <span class="keyword">class </span><a class="code" href="classdb_1_1expr_1_1in.html" title="in Operator">in</a> : <span class="keyword">public</span> <a class="code" href="classdb_1_1expr_1_1oper.html" title="base class for operators in sql terms">oper</a> {
<a name="l00668"></a>00668     <span class="keyword">public</span>:
<a name="l00679"></a>00679       <span class="keyword">explicit</span> <a class="code" href="classdb_1_1expr_1_1in.html#a8ebc456dda9925e8275b4ebf0b2a5375" title="in">in</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; <span class="keyword">set</span>)
<a name="l00680"></a>00680         : <a class="code" href="classdb_1_1expr_1_1oper.html#a48753e202440521e07b9509636195b84" title="string overload">oper</a>(fld, DB_TEXT(<span class="stringliteral">&quot;IN&quot;</span>), DB_TEXT(<span class="stringliteral">&quot;(&quot;</span>)+<span class="keyword">set</span>+DB_TEXT(<span class="stringliteral">&quot;)&quot;</span>)) 
<a name="l00681"></a>00681       {}
<a name="l00682"></a>00682 
<a name="l00693"></a>00693       <span class="keyword">explicit</span> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1in.html#a8ebc456dda9925e8275b4ebf0b2a5375" title="in">in</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> &amp; fld, <span class="keyword">const</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a>&amp; s);
<a name="l00694"></a>00694 
<a name="l00703"></a>00703       <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classdb_1_1expr_1_1in.html#a253a74a45e376713b4115d9803a8f41b" title="str">str</a>()<span class="keyword"> const </span>
<a name="l00704"></a>00704 <span class="keyword">      </span>{ <span class="keywordflow">return</span> _field.fullName() + DB_TEXT(<span class="stringliteral">&quot; &quot;</span>) + op + DB_TEXT(<span class="stringliteral">&quot; &quot;</span>) + data; }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706     };
<a name="l00707"></a>00707   }
<a name="l00708"></a><a class="code" href="classdb_1_1param.html">00708</a> 
<a name="l00710"></a>00710   <span class="keyword">class </span><a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a> 
<a name="l00711"></a>00711 <span class="comment">//#ifndef BOOST_NO_STD_LOCALE</span>
<a name="l00712"></a>00712 <span class="comment">//    : sigb::trackable</span>
<a name="l00713"></a>00713 <span class="comment">//#endif // _DEBUG</span>
<a name="l00714"></a>00714   {
<a name="l00715"></a>00715     <span class="keywordtype">string</span> _data;
<a name="l00716"></a>00716     param_types _type;
<a name="l00717"></a>00717     <span class="keywordtype">bool</span> _is_changed;
<a name="l00718"></a>00718     <span class="keywordtype">unsigned</span> _col; 
<a name="l00719"></a>00719 
<a name="l00728"></a>00728     <a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a>() : _type(e_null), _is_changed(<span class="keyword">false</span>)
<a name="l00729"></a>00729     { _data = DB_TEXT(<span class="stringliteral">&quot;&quot;</span>); }
<a name="l00730"></a>00730   <span class="keyword">public</span>:
<a name="l00740"></a>00740     <a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a>(<span class="keywordtype">unsigned</span> col) : _col(col), _type(e_null), _is_changed(<span class="keyword">false</span>)
<a name="l00741"></a>00741     { _data = DB_TEXT(<span class="stringliteral">&quot;&quot;</span>); }
<a name="l00742"></a>00742 
<a name="l00751"></a>00751     <a class="code" href="classdb_1_1param.html#a2a6ede88ce9e209be29d48ba806cf02d" title="~param">~param</a>() 
<a name="l00752"></a>00752     {}
<a name="l00753"></a>00753 
<a name="l00763"></a>00763     <a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a>&amp; Param) : _col(Param._col), _type(Param._type), 
<a name="l00764"></a>00764       _is_changed(<span class="keyword">false</span>), _data(Param._data) 
<a name="l00765"></a>00765     { }               
<a name="l00766"></a>00766 
<a name="l00774"></a>00774     param_types <a class="code" href="classdb_1_1param.html#adf04bb15daefada541c37dee2bafba02">get_type</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _type; }
<a name="l00775"></a>00775 
<a name="l00785"></a>00785     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1param.html#ac8d069fa3923ac5abfd3858d37646272" title="set_type">set_type</a>(param_types Type) { _type = Type; }
<a name="l00786"></a>00786 
<a name="l00795"></a>00795     <span class="keywordtype">bool</span>&amp; <a class="code" href="classdb_1_1param.html#ad8de2e0d588ff630ee657b1b82e39db3" title="is param changed?">is_changed</a>() { <span class="keywordflow">return</span> _is_changed; }
<a name="l00796"></a>00796 
<a name="l00805"></a>00805     <span class="keywordtype">void</span> <span class="keyword">set</span>(sqlite3_stmt* stm)
<a name="l00806"></a>00806     {
<a name="l00807"></a>00807       <span class="keywordflow">if</span> (!stm)
<a name="l00808"></a>00808       {
<a name="l00809"></a>00809         <a class="code" href="classdb_1_1param.html#a0c877f25837a58ff01b2134d871eeb58" title="set_null">set_null</a>();
<a name="l00810"></a>00810         <span class="keywordflow">return</span>;
<a name="l00811"></a>00811       }
<a name="l00812"></a>00812 
<a name="l00813"></a>00813       <span class="keywordflow">switch</span>(sqlite3_column_type(stm, _col)) 
<a name="l00814"></a>00814       {
<a name="l00815"></a>00815       <span class="keywordflow">case</span> SQLITE_INTEGER:
<a name="l00816"></a>00816         <span class="keyword">set</span>(sqlite3_column_int(stm, _col));
<a name="l00817"></a>00817         <span class="keywordflow">break</span>;
<a name="l00818"></a>00818       <span class="keywordflow">case</span> SQLITE_FLOAT:
<a name="l00819"></a>00819         <span class="keyword">set</span>(sqlite3_column_double(stm, _col));
<a name="l00820"></a>00820         <span class="keywordflow">break</span>;
<a name="l00821"></a>00821       <span class="keywordflow">case</span> SQLITE_TEXT:
<a name="l00822"></a>00822 <span class="preprocessor">#ifdef _UNICODE</span>
<a name="l00823"></a>00823 <span class="preprocessor"></span>        <span class="keyword">set</span>(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">wchar_t</span>*<span class="keyword">&gt;</span>(
<a name="l00824"></a>00824           sqlite3_column_text16(stm, _col)));
<a name="l00825"></a>00825 <span class="preprocessor">#else</span>
<a name="l00826"></a>00826 <span class="preprocessor"></span>        <span class="keyword">set</span>(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(
<a name="l00827"></a>00827           sqlite3_column_text(stm, _col)));
<a name="l00828"></a>00828 <span class="preprocessor">#endif // _UNICODE</span>
<a name="l00829"></a>00829 <span class="preprocessor"></span>        <span class="keywordflow">break</span>;
<a name="l00830"></a>00830       <span class="keywordflow">case</span> SQLITE_BLOB:
<a name="l00831"></a>00831         {
<a name="l00832"></a>00832 <span class="preprocessor">#ifdef _UNICODE</span>
<a name="l00833"></a>00833 <span class="preprocessor"></span>          std::string blob(reinterpret_cast&lt;const char*&gt;(
<a name="l00834"></a>00834             sqlite3_column_blob(stm, _col)));
<a name="l00835"></a>00835                     std::wstring wblob = <a class="code" href="classdb_1_1detail_1_1a2w.html" title="char to wchar_t conversion class">detail::a2w</a>(blob.c_str());
<a name="l00836"></a>00836           <span class="keyword">set</span>(wblob);
<a name="l00837"></a>00837 <span class="preprocessor">#else</span>
<a name="l00838"></a>00838 <span class="preprocessor"></span>          <span class="keyword">set</span>(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(
<a name="l00839"></a>00839             sqlite3_column_blob(stm, _col)));
<a name="l00840"></a>00840 <span class="preprocessor">#endif // _UNICODE</span>
<a name="l00841"></a>00841 <span class="preprocessor"></span>        }
<a name="l00842"></a>00842         <span class="keywordflow">break</span>;
<a name="l00843"></a>00843       <span class="keywordflow">case</span> SQLITE_NULL:
<a name="l00844"></a>00844         <a class="code" href="classdb_1_1param.html#a0c877f25837a58ff01b2134d871eeb58" title="set_null">set_null</a>();
<a name="l00845"></a>00845         <span class="keywordflow">break</span>;
<a name="l00846"></a>00846       <span class="keywordflow">default</span>:
<a name="l00847"></a>00847         <a class="code" href="classdb_1_1param.html#a0c877f25837a58ff01b2134d871eeb58" title="set_null">set_null</a>();
<a name="l00848"></a>00848       } 
<a name="l00849"></a>00849     }
<a name="l00850"></a><a class="code" href="classdb_1_1param.html#a9ce8359f1e33f6bc9c58a2a75678d90c">00850</a> 
<a name="l00852"></a>00852     <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keywordtype">bool</span> dat)
<a name="l00853"></a>00853     { 
<a name="l00854"></a>00854       _type = e_bool;
<a name="l00855"></a>00855       _data = dat ? DB_TEXT(<span class="stringliteral">&quot;TRUE&quot;</span>) : DB_TEXT(<span class="stringliteral">&quot;FALSE&quot;</span>);
<a name="l00856"></a><a class="code" href="classdb_1_1param.html#aa794a48c19b2ab92cf2e36b3e1d9aa54">00856</a>     } 
<a name="l00858"></a>00858     <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keywordtype">int</span> dat)
<a name="l00859"></a>00859     { 
<a name="l00860"></a>00860       _type = e_int;
<a name="l00861"></a>00861       _data = <a class="code" href="classdb_1_1param.html#a66a7cbc5eaeb5d9c70f808304beaf786">boost::str</a>(format(DB_TEXT(<span class="stringliteral">&quot;%d&quot;</span>)) % dat);
<a name="l00862"></a><a class="code" href="classdb_1_1param.html#a7dd495f94eb2acfd6f5a4e7ef9bb5518">00862</a>     } 
<a name="l00864"></a>00864     <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keywordtype">unsigned</span> dat)
<a name="l00865"></a>00865     { 
<a name="l00866"></a>00866       _type = e_unsigned;
<a name="l00867"></a>00867       _data = <a class="code" href="classdb_1_1param.html#a66a7cbc5eaeb5d9c70f808304beaf786">boost::str</a>(format(DB_TEXT(<span class="stringliteral">&quot;%d&quot;</span>)) % dat);
<a name="l00868"></a><a class="code" href="classdb_1_1param.html#a66e04b736a668e2c78a3fac4a55db535">00868</a>     } 
<a name="l00870"></a>00870     <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keywordtype">long</span> dat)
<a name="l00871"></a>00871     { 
<a name="l00872"></a>00872       _type = e_long;
<a name="l00873"></a>00873       _data = <a class="code" href="classdb_1_1param.html#a66a7cbc5eaeb5d9c70f808304beaf786">boost::str</a>(format(DB_TEXT(<span class="stringliteral">&quot;%ld&quot;</span>)) % dat);
<a name="l00874"></a><a class="code" href="classdb_1_1param.html#afd8fde55c3a2a564e81439306ac7bedd">00874</a>     } 
<a name="l00876"></a>00876     <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keywordtype">float</span> dat)
<a name="l00877"></a>00877     { 
<a name="l00878"></a>00878       _type = e_float;
<a name="l00879"></a>00879       _data = <a class="code" href="classdb_1_1param.html#a66a7cbc5eaeb5d9c70f808304beaf786">boost::str</a>(format(DB_TEXT(<span class="stringliteral">&quot;%f&quot;</span>)) % dat);
<a name="l00880"></a><a class="code" href="classdb_1_1param.html#a6eb7f8f004b33aa527cc86038552d10e">00880</a>     } 
<a name="l00882"></a>00882     <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keywordtype">double</span> dat)
<a name="l00883"></a>00883     { 
<a name="l00884"></a>00884       _type = e_double;
<a name="l00885"></a>00885       _data = <a class="code" href="classdb_1_1param.html#a66a7cbc5eaeb5d9c70f808304beaf786">boost::str</a>(format(DB_TEXT(<span class="stringliteral">&quot;%f&quot;</span>)) % dat);
<a name="l00886"></a><a class="code" href="classdb_1_1param.html#a6c7bf0a2010dbe5c8a8446b239b6ce27">00886</a>     } 
<a name="l00888"></a>00888     <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keywordtype">char</span> dat)
<a name="l00889"></a>00889     { 
<a name="l00890"></a>00890       _type = e_char;
<a name="l00891"></a>00891       _data = dat;
<a name="l00892"></a><a class="code" href="classdb_1_1param.html#a841b234f7fceaa7243381610fd997ff1">00892</a>     } 
<a name="l00894"></a>00894     <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keyword">const</span> db::char_type* dat)
<a name="l00895"></a>00895     { 
<a name="l00896"></a>00896       _type = e_string;
<a name="l00897"></a>00897       _data = dat;
<a name="l00898"></a><a class="code" href="classdb_1_1param.html#a809b7a70b7bc7ff8efc32be348205f14">00898</a>     } 
<a name="l00900"></a>00900     <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; dat, <span class="keywordtype">bool</span> isBlob=<span class="keyword">false</span>)
<a name="l00901"></a>00901     { 
<a name="l00902"></a>00902       _type = isBlob?e_blob:e_string;
<a name="l00903"></a>00903       _data = dat;
<a name="l00904"></a>00904     } 
<a name="l00905"></a>00905 
<a name="l00906"></a><a class="code" href="classdb_1_1param.html#a78212ff0e9ac0039eeed630976e3d192">00906</a> <span class="preprocessor">#ifndef BOOST_NO_STD_LOCALE</span>
<a name="l00907"></a>00907 <span class="preprocessor"></span>
<a name="l00908"></a>00908         <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keyword">const</span> boost::gregorian::date&amp; dat)
<a name="l00909"></a>00909     { 
<a name="l00910"></a>00910       _type = e_date_time;
<a name="l00911"></a>00911       _data = detail::to_sql_string(dat);
<a name="l00912"></a>00912     } 
<a name="l00913"></a>00913 <span class="preprocessor">#else</span>
<a name="l00914"></a>00914 <span class="preprocessor"></span>
<a name="l00915"></a>00915     <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keyword">const</span> time_t_ce&amp; dat)
<a name="l00916"></a>00916     { 
<a name="l00917"></a>00917       _type = e_date_time;
<a name="l00918"></a>00918       _data = detail::to_sql_string(dat);
<a name="l00919"></a>00919     } 
<a name="l00920"></a>00920 <span class="preprocessor">#endif</span>
<a name="l00921"></a>00921 <span class="preprocessor"></span>
<a name="l00930"></a>00930     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1param.html#a0c877f25837a58ff01b2134d871eeb58" title="set_null">set_null</a>() { _type=e_null; _data = DB_TEXT(<span class="stringliteral">&quot;&quot;</span>); }
<a name="l00931"></a>00931 
<a name="l00941"></a>00941     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1param.html#af4c4d23f177280b5eda53c26389ca485" title="set_with_old_type">set_with_old_type</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; data)
<a name="l00942"></a>00942     {
<a name="l00943"></a>00943       param_types ty(<a class="code" href="classdb_1_1param.html#adf04bb15daefada541c37dee2bafba02">get_type</a>());
<a name="l00944"></a>00944       <span class="keyword">set</span>(data);
<a name="l00945"></a>00945       <a class="code" href="classdb_1_1param.html#ac8d069fa3923ac5abfd3858d37646272" title="set_type">set_type</a>(ty);
<a name="l00946"></a>00946     }
<a name="l00947"></a>00947 
<a name="l00957"></a>00957     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1param.html#af4c4d23f177280b5eda53c26389ca485" title="set_with_old_type">set_with_old_type</a>(<span class="keyword">const</span> param&amp; data)
<a name="l00958"></a>00958     {
<a name="l00959"></a>00959       param_types ty(<a class="code" href="classdb_1_1param.html#adf04bb15daefada541c37dee2bafba02">get_type</a>());
<a name="l00960"></a>00960       <span class="keyword">set</span>(data.str());
<a name="l00961"></a>00961       <a class="code" href="classdb_1_1param.html#ac8d069fa3923ac5abfd3858d37646272" title="set_type">set_type</a>(ty);
<a name="l00962"></a>00962     }
<a name="l00963"></a>00963 
<a name="l00973"></a>00973     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1param.html#af4c4d23f177280b5eda53c26389ca485" title="set_with_old_type">set_with_old_type</a>(<span class="keyword">const</span> param* data)
<a name="l00974"></a>00974     {
<a name="l00975"></a>00975       <span class="keywordflow">if</span> (!data)
<a name="l00976"></a>00976         <span class="keywordflow">return</span>;
<a name="l00977"></a>00977       param_types ty(<a class="code" href="classdb_1_1param.html#adf04bb15daefada541c37dee2bafba02">get_type</a>());
<a name="l00978"></a>00978       <span class="keyword">set</span>(data-&gt;str());
<a name="l00979"></a>00979       <a class="code" href="classdb_1_1param.html#ac8d069fa3923ac5abfd3858d37646272" title="set_type">set_type</a>(ty);
<a name="l00980"></a>00980     }
<a name="l00981"></a>00981 
<a name="l00990"></a>00990     <span class="keywordtype">bool</span> <a class="code" href="classdb_1_1param.html#ae188c6f1e44b49e967e87de7ee860c09" title="is_null">is_null</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _type==e_null ? <span class="keyword">true</span> : <span class="keyword">false</span>; }
<a name="l00991"></a>00991 
<a name="l00999"></a>00999     <span class="keywordtype">bool</span> <a class="code" href="classdb_1_1param.html#a8e6b69b1adb4ada02c9a0d539bbae1cc">get_bool</a>()<span class="keyword"> const</span>
<a name="l01000"></a>01000 <span class="keyword">    </span>{
<a name="l01001"></a>01001       <span class="keywordflow">if</span> (_type == e_bool)
<a name="l01002"></a>01002         <span class="keywordflow">return</span> _data == DB_TEXT(<span class="stringliteral">&quot;TRUE&quot;</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l01003"></a>01003       <span class="keywordflow">else</span>
<a name="l01004"></a>01004         <span class="keywordflow">return</span> <span class="keyword">false</span>; 
<a name="l01005"></a>01005     } 
<a name="l01006"></a>01006 
<a name="l01007"></a>01007 
<a name="l01015"></a>01015     <span class="keywordtype">int</span> <a class="code" href="classdb_1_1param.html#a3aa69dbadd6770fb7a9e81315874a2f3">get_int</a>()<span class="keyword"> const</span>
<a name="l01016"></a>01016 <span class="keyword">    </span>{
<a name="l01017"></a>01017       <span class="keywordflow">return</span> detail::to_type&lt;int&gt;(_data);
<a name="l01018"></a>01018     }
<a name="l01019"></a>01019 
<a name="l01027"></a>01027     <span class="keywordtype">unsigned</span> <a class="code" href="classdb_1_1param.html#abffc15f1d76d5e2fed7e6b1d21a65883">get_unsigned</a>()<span class="keyword"> const</span>
<a name="l01028"></a>01028 <span class="keyword">    </span>{
<a name="l01029"></a>01029       <span class="keywordflow">return</span> detail::to_type&lt;unsigned&gt;(_data);
<a name="l01030"></a>01030     }
<a name="l01031"></a>01031 
<a name="l01039"></a>01039     <span class="keywordtype">long</span> <a class="code" href="classdb_1_1param.html#a6cc97c5e2aad9e03daf0c91b38d701d3">get_long</a>()<span class="keyword"> const</span>
<a name="l01040"></a>01040 <span class="keyword">    </span>{
<a name="l01041"></a>01041       <span class="keywordflow">return</span> detail::to_type&lt;long&gt;(_data);
<a name="l01042"></a>01042     }
<a name="l01043"></a>01043 
<a name="l01051"></a>01051     <span class="keywordtype">float</span> <a class="code" href="classdb_1_1param.html#adf2bddebceefe47e0ede73441112cb60">get_float</a>()<span class="keyword"> const</span>
<a name="l01052"></a>01052 <span class="keyword">    </span>{
<a name="l01053"></a>01053       <span class="keywordflow">return</span> detail::to_type&lt;float&gt;(_data);
<a name="l01054"></a>01054     }
<a name="l01055"></a>01055 
<a name="l01063"></a>01063     <span class="keywordtype">double</span> <a class="code" href="classdb_1_1param.html#a7879f07929a766a4f47fdff39edabac3">get_double</a>()<span class="keyword"> const</span>
<a name="l01064"></a>01064 <span class="keyword">    </span>{
<a name="l01065"></a>01065       <span class="keywordflow">return</span> detail::to_type&lt;double&gt;(_data);
<a name="l01066"></a>01066     }
<a name="l01067"></a>01067 
<a name="l01075"></a>01075     db::char_type <a class="code" href="classdb_1_1param.html#a328dcac14b7c5b973f9185ddbea59a91">get_char</a>()<span class="keyword"> const </span>
<a name="l01076"></a>01076 <span class="keyword">    </span>{
<a name="l01077"></a>01077       <span class="keywordflow">if</span> (_data.length()==0)
<a name="l01078"></a>01078         <span class="keywordflow">return</span> DB_TEXT(<span class="charliteral">&#39; &#39;</span>);
<a name="l01079"></a>01079       <span class="keywordflow">else</span>
<a name="l01080"></a>01080         <span class="keywordflow">return</span> _data[0];
<a name="l01081"></a>01081     }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083     operator string()<span class="keyword"> const</span>
<a name="l01084"></a>01084 <span class="keyword">    </span>{ <span class="keywordflow">return</span> _data; }
<a name="l01085"></a>01085 
<a name="l01093"></a>01093     <span class="keywordtype">string</span>&amp; <a class="code" href="classdb_1_1param.html#a66a7cbc5eaeb5d9c70f808304beaf786">str</a>()
<a name="l01094"></a>01094     { <span class="keywordflow">return</span> _data; }
<a name="l01095"></a>01095 
<a name="l01103"></a>01103     <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; <a class="code" href="classdb_1_1param.html#a66a7cbc5eaeb5d9c70f808304beaf786">str</a>()<span class="keyword"> const</span>
<a name="l01104"></a>01104 <span class="keyword">    </span>{ <span class="keywordflow">return</span> _data; }
<a name="l01105"></a>01105 
<a name="l01106"></a>01106 <span class="preprocessor">#ifdef _UNICODE</span>
<a name="l01107"></a>01107 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* c_str()<span class="keyword"> const</span>
<a name="l01108"></a>01108 <span class="keyword">    </span>{ <span class="keywordflow">return</span> _data.c_str(); }
<a name="l01109"></a>01109 <span class="preprocessor">#else</span>
<a name="l01110"></a>01110 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* c_str()<span class="keyword"> const</span>
<a name="l01111"></a>01111 <span class="keyword">    </span>{ <span class="keywordflow">return</span> _data.c_str(); }
<a name="l01112"></a>01112 <span class="preprocessor">#endif // _UNICODE</span>
<a name="l01113"></a>01113 <span class="preprocessor"></span>
<a name="l01114"></a>01114 <span class="preprocessor">#ifndef BOOST_NO_STD_LOCALE</span>
<a name="l01115"></a>01115 <span class="preprocessor"></span>
<a name="l01116"></a>01116 
<a name="l01117"></a>01117 
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 
<a name="l01120"></a><a class="code" href="classdb_1_1param.html#a43e7d0125064bd9109e2b236f1aed447">01120</a> 
<a name="l01121"></a>01121 
<a name="l01122"></a>01122     boost::gregorian::date <a class="code" href="classdb_1_1param.html#a43e7d0125064bd9109e2b236f1aed447">get_date_time</a>()<span class="keyword"> const</span>
<a name="l01123"></a>01123 <span class="keyword">    </span>{
<a name="l01124"></a>01124 <span class="preprocessor">#ifdef _UNICODE</span>
<a name="l01125"></a>01125 <span class="preprocessor"></span>            std::string data = <a class="code" href="classdb_1_1detail_1_1w2a.html" title="wchar_t to char conversion class">detail::w2a</a>(_data.c_str());
<a name="l01126"></a>01126       <span class="keywordflow">return</span> boost::date_time::parse_date&lt;
<a name="l01127"></a>01127         boost::gregorian::date&gt;(data);
<a name="l01128"></a>01128 <span class="preprocessor">#else</span>
<a name="l01129"></a>01129 <span class="preprocessor"></span>      <span class="keywordflow">return</span> boost::date_time::parse_date&lt;
<a name="l01130"></a>01130         boost::gregorian::date&gt;(_data);
<a name="l01131"></a>01131 <span class="preprocessor">#endif // _UNICODE</span>
<a name="l01132"></a>01132 <span class="preprocessor"></span>    }
<a name="l01133"></a>01133 <span class="preprocessor">#else</span>
<a name="l01134"></a>01134 <span class="preprocessor"></span>
<a name="l01135"></a>01135 
<a name="l01136"></a>01136 
<a name="l01137"></a>01137 
<a name="l01138"></a>01138 
<a name="l01139"></a>01139 
<a name="l01140"></a>01140 
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     time_t_ce <a class="code" href="classdb_1_1param.html#a43e7d0125064bd9109e2b236f1aed447">get_date_time</a>(<span class="keyword">const</span> time_t_ce* tmp = 0)<span class="keyword"> const</span>
<a name="l01143"></a>01143 <span class="keyword">    </span>{ <span class="keywordflow">return</span> detail::from_sql_string(_data, tmp); }
<a name="l01144"></a>01144 <span class="preprocessor">#endif</span>
<a name="l01145"></a>01145 <span class="preprocessor"></span>
<a name="l01146"></a>01146 <span class="preprocessor">#ifdef _MFC_VER</span>
<a name="l01147"></a>01147 <span class="preprocessor"></span>
<a name="l01148"></a>01148 
<a name="l01149"></a>01149 
<a name="l01150"></a>01150 
<a name="l01151"></a>01151 
<a name="l01152"></a>01152 
<a name="l01153"></a><a class="code" href="classdb_1_1param.html#a5359898b08cfc094f4398024ced95e9e">01153</a> 
<a name="l01154"></a>01154 
<a name="l01155"></a>01155     COleDateTime <a class="code" href="classdb_1_1param.html#a43e7d0125064bd9109e2b236f1aed447">get_date_time</a>(<span class="keyword">const</span> COleDateTime* tmp = 0)<span class="keyword"> const</span>
<a name="l01156"></a>01156 <span class="keyword">    </span>{ <span class="keywordflow">return</span> detail::from_sql_string(_data, tmp); }
<a name="l01157"></a>01157 <span class="preprocessor">#endif // _MFCVER</span>
<a name="l01158"></a>01158 <span class="preprocessor"></span>
<a name="l01168"></a>01168     <span class="keyword">const</span> <a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a>&amp; <a class="code" href="classdb_1_1param.html#a9949fa9375cd50e490346d254f10ca5e" title="operator=">operator=</a>( <span class="keyword">const</span> <a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a> &amp;v )
<a name="l01169"></a>01169     {
<a name="l01170"></a>01170       _data = v._data;
<a name="l01171"></a>01171       _type = v._type;
<a name="l01172"></a>01172       _is_changed = v._is_changed;
<a name="l01173"></a>01173       <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
<a name="l01174"></a>01174     }
<a name="l01175"></a>01175 
<a name="l01184"></a>01184     <span class="keywordtype">bool</span> <a class="code" href="classdb_1_1param.html#a455ab1f2e5b020b43aeea017f85daaab" title="operator!">operator!</a>()<span class="keyword"> const </span>
<a name="l01185"></a>01185 <span class="keyword">    </span>{ <span class="keywordflow">return</span> !this-&gt;<a class="code" href="classdb_1_1param.html#ae188c6f1e44b49e967e87de7ee860c09" title="is_null">is_null</a>(); }
<a name="l01186"></a>01186 
<a name="l01196"></a>01196     <span class="keywordtype">bool</span> <a class="code" href="classdb_1_1param.html#a41bd9be26a79f0a50baf232e52da494b" title="operator==">operator== </a>(<span class="keyword">const</span> param&amp; v)<span class="keyword"> const </span>
<a name="l01197"></a>01197 <span class="keyword">    </span>{ <span class="keywordflow">return</span> (!(*<span class="keyword">this</span>) &amp;&amp; (!v) &amp;&amp; _data == v._data); }
<a name="l01198"></a>01198 
<a name="l01199"></a>01199 <span class="comment">//#ifndef BOOST_NO_STD_LOCALE</span>
<a name="l01200"></a>01200 <span class="comment">//    typedef boost::signal2&lt;void, const string&amp;, bool&amp;&gt; type_signal_external_check; </span>
<a name="l01201"></a>01201 <span class="comment">//    type_signal_external_check signal_external_check;</span>
<a name="l01202"></a>01202 <span class="comment">//#endif // BOOST_NO_STD_LOCALE</span>
<a name="l01203"></a>01203   };
<a name="l01204"></a>01204   <span class="keyword">typedef</span> boost::detail::allocator::partial_std_allocator_wrapper&lt;
<a name="l01205"></a>01205     boost::detail::quick_allocator&lt;param &gt; &gt; alloc_param; 
<a name="l01206"></a>01206 
<a name="l01207"></a>01207   <span class="keyword">namespace </span>detail
<a name="l01208"></a>01208   {
<a name="l01209"></a>01209     <span class="keyword">template</span>&lt;&gt; 
<a name="l01210"></a>01210     <span class="keyword">inline</span> <span class="keywordtype">string</span> to_string(<span class="keyword">const</span> <a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">db::param</a>&amp; a) 
<a name="l01211"></a>01211     { <span class="keywordflow">return</span> a.<a class="code" href="classdb_1_1param.html#a66a7cbc5eaeb5d9c70f808304beaf786">str</a>(); } 
<a name="l01212"></a>01212     }
<a name="l01213"></a><a class="code" href="classdb_1_1row.html">01213</a> 
<a name="l01215"></a>01215   <span class="keyword">class </span><a class="code" href="classdb_1_1row.html" title="table rows interface">row</a>
<a name="l01216"></a>01216   {
<a name="l01217"></a>01217   <span class="keyword">protected</span>:
<a name="l01218"></a>01218     <span class="keyword">typedef</span> std::vector&lt;param, alloc_param &gt; data_type;
<a name="l01219"></a>01219     data_type _data;
<a name="l01220"></a>01220     <span class="keywordtype">unsigned</span> _row;
<a name="l01221"></a>01221     <a class="code" href="classdb_1_1query.html" title="cursor interface">query</a>* _query;
<a name="l01222"></a>01222 
<a name="l01223"></a>01223   <span class="keyword">public</span>:
<a name="l01224"></a>01224     <span class="keyword">typedef</span> data_type::value_type value_type;
<a name="l01225"></a>01225     <span class="keyword">typedef</span> data_type::reference reference;
<a name="l01226"></a>01226     <span class="keyword">typedef</span> data_type::const_reference const_reference;
<a name="l01227"></a>01227     <span class="keyword">typedef</span> data_type::size_type size_type;
<a name="l01228"></a>01228     <span class="keyword">typedef</span> data_type::difference_type difference_type;
<a name="l01229"></a>01229     <span class="keyword">typedef</span> data_type::iterator iterator;
<a name="l01230"></a>01230     <span class="keyword">typedef</span> data_type::reverse_iterator reverse_iterator;
<a name="l01231"></a>01231     <span class="keyword">typedef</span> data_type::const_iterator const_iterator;
<a name="l01232"></a>01232 
<a name="l01243"></a>01243     <a class="code" href="classdb_1_1row.html#a49ac43cf5f53f7a540556c45f751335c" title="row">row</a>(<a class="code" href="classdb_1_1query.html" title="cursor interface">query</a>* query_, <span class="keywordtype">unsigned</span> row_) : _query(query_), _row(row_)
<a name="l01244"></a>01244     {
<a name="l01245"></a>01245     }
<a name="l01246"></a>01246 
<a name="l01256"></a>01256     <a class="code" href="classdb_1_1row.html#a49ac43cf5f53f7a540556c45f751335c" title="row">row</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1row.html" title="table rows interface">row</a>&amp; r) : _query(r._query), _row(r._row)
<a name="l01257"></a>01257     {
<a name="l01258"></a>01258       _data.reserve(r.<a class="code" href="classdb_1_1row.html#adb777bf797d96c2aa2dd4286c2e1120f" title="container size">size</a>());
<a name="l01259"></a>01259       std::copy(r.<a class="code" href="classdb_1_1row.html#aea231de621a901970228a4054ce2742b" title="const begin iterator">begin</a>(), r.<a class="code" href="classdb_1_1row.html#a5997d3c76902799d0d9c4fa472c6db69" title="const end iterator">end</a>(), std::back_inserter(_data));
<a name="l01260"></a>01260     }
<a name="l01261"></a>01261 
<a name="l01270"></a>01270     <a class="code" href="classdb_1_1row.html#ab49a7d72bf93170636f1f3df5596c7d6" title="~row">~row</a>() {}
<a name="l01271"></a>01271 
<a name="l01272"></a>01272 
<a name="l01282"></a>01282     <span class="keyword">const</span> <a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a>&amp; <a class="code" href="classdb_1_1row.html#a8155cc441fd3131231dc747df41b274e" title="get a value by number">value</a>(size_type field_num)<span class="keyword"> const</span>
<a name="l01283"></a>01283 <span class="keyword">    </span>{ 
<a name="l01284"></a>01284       <span class="keyword">const</span> value_type&amp; pValue(*(<a class="code" href="classdb_1_1row.html#aea231de621a901970228a4054ce2742b" title="const begin iterator">begin</a>()+field_num));
<a name="l01285"></a>01285       <span class="keywordflow">return</span> pValue; 
<a name="l01286"></a>01286     }
<a name="l01287"></a>01287 
<a name="l01297"></a>01297     <a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a>&amp; <a class="code" href="classdb_1_1row.html#a8155cc441fd3131231dc747df41b274e" title="get a value by number">value</a>(size_type field_num)
<a name="l01298"></a>01298     { 
<a name="l01299"></a>01299       value_type&amp; pValue(*(<a class="code" href="classdb_1_1row.html#aea231de621a901970228a4054ce2742b" title="const begin iterator">begin</a>()+field_num));
<a name="l01300"></a>01300       <span class="keywordflow">return</span> pValue; 
<a name="l01301"></a>01301     }
<a name="l01302"></a>01302 
<a name="l01312"></a>01312     const_reference <a class="code" href="classdb_1_1row.html#a870a821367df8dfc96c9ecfd0a7ec152" title="get a value by number">operator[] </a>(size_type field_num)<span class="keyword"> const</span>
<a name="l01313"></a>01313 <span class="keyword">    </span>{ <span class="keywordflow">return</span> *(<a class="code" href="classdb_1_1row.html#aea231de621a901970228a4054ce2742b" title="const begin iterator">begin</a>()+field_num); }
<a name="l01314"></a>01314 
<a name="l01324"></a>01324     reference <a class="code" href="classdb_1_1row.html#a870a821367df8dfc96c9ecfd0a7ec152" title="get a value by number">operator[] </a>(size_type field_num)
<a name="l01325"></a>01325     { <span class="keywordflow">return</span> *(<a class="code" href="classdb_1_1row.html#aea231de621a901970228a4054ce2742b" title="const begin iterator">begin</a>()+field_num); }
<a name="l01326"></a>01326 
<a name="l01337"></a>01337     <a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a>* <a class="code" href="classdb_1_1row.html#a870a821367df8dfc96c9ecfd0a7ec152" title="get a value by number">operator[] </a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; field_title)
<a name="l01338"></a>01338     { 
<a name="l01339"></a>01339             <a class="code" href="config_8hpp.html#ac830dd94a45984c0ad47afc38882bdbf">UNREFERENCED_PARAMETER</a>(field_title); 
<a name="l01340"></a>01340             <span class="keywordflow">return</span> (0); 
<a name="l01341"></a>01341         }
<a name="l01342"></a>01342 
<a name="l01351"></a>01351     const_iterator <a class="code" href="classdb_1_1row.html#aea231de621a901970228a4054ce2742b" title="const begin iterator">begin</a>()<span class="keyword"> const          </span>{ <span class="keywordflow">return</span> _data.begin(); }
<a name="l01352"></a>01352 
<a name="l01361"></a>01361     const_iterator <a class="code" href="classdb_1_1row.html#a5997d3c76902799d0d9c4fa472c6db69" title="const end iterator">end</a>()<span class="keyword"> const            </span>{ <span class="keywordflow">return</span> _data.end(); }
<a name="l01362"></a>01362 
<a name="l01371"></a>01371     iterator <a class="code" href="classdb_1_1row.html#aea231de621a901970228a4054ce2742b" title="const begin iterator">begin</a>()                      { <span class="keywordflow">return</span> _data.begin(); }
<a name="l01372"></a>01372 
<a name="l01381"></a>01381     iterator <a class="code" href="classdb_1_1row.html#a5997d3c76902799d0d9c4fa472c6db69" title="const end iterator">end</a>()                        { <span class="keywordflow">return</span> _data.end(); }
<a name="l01382"></a>01382 
<a name="l01391"></a>01391     reverse_iterator <a class="code" href="classdb_1_1row.html#af548aea1cad71b66ef9a710733816159" title="begin reverse iterator">rbegin</a>()             { <span class="keywordflow">return</span> _data.rbegin(); }
<a name="l01392"></a>01392 
<a name="l01401"></a>01401     reverse_iterator <a class="code" href="classdb_1_1row.html#a39587a854f6c6d3b0c78c035a65ff716" title="end reverse iterator">rend</a>()               { <span class="keywordflow">return</span> _data.rend(); }
<a name="l01402"></a>01402 
<a name="l01411"></a>01411     size_type <a class="code" href="classdb_1_1row.html#adb777bf797d96c2aa2dd4286c2e1120f" title="container size">size</a>()<span class="keyword"> const                </span>{ <span class="keywordflow">return</span> _data.size(); }
<a name="l01412"></a>01412 
<a name="l01421"></a>01421     <span class="keywordtype">bool</span> <a class="code" href="classdb_1_1row.html#a8e44aeccb8c2fdef339f3ac112ebf742" title="returns true if the container is empty">empty</a>()<span class="keyword"> const                    </span>{ <span class="keywordflow">return</span> _data.empty(); }
<a name="l01422"></a>01422 
<a name="l01432"></a>01432     <span class="keywordtype">bool</span> <a class="code" href="classdb_1_1row.html#a36046f580a827d7f341b2bbc4752ddc9" title="operator==">operator==</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1row.html" title="table rows interface">row</a>&amp; t)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _data == t._data; }
<a name="l01433"></a>01433 
<a name="l01443"></a>01443     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1row.html#ae87993a6a14952cb7fc498b2a292a937" title="push a param to the container">push_back</a>(<span class="keyword">const</span> value_type&amp; v)  { _data.push_back(v); }
<a name="l01444"></a>01444 
<a name="l01454"></a>01454     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classdb_1_1row.html#a38f3b6a5568643438119729633630921" title="fill">fill</a>(sqlite3_stmt* stm);
<a name="l01455"></a>01455 
<a name="l01456"></a>01456   };
<a name="l01457"></a>01457   <span class="keyword">typedef</span> boost::detail::allocator::partial_std_allocator_wrapper&lt;
<a name="l01458"></a>01458     boost::detail::quick_allocator&lt;row &gt; &gt; alloc_row; 
<a name="l01459"></a><a class="code" href="classdb_1_1query.html">01459</a> 
<a name="l01461"></a>01461   <span class="keyword">class </span><a class="code" href="classdb_1_1query.html" title="cursor interface">query</a>
<a name="l01462"></a>01462   {
<a name="l01463"></a>01463   <span class="keyword">protected</span>:
<a name="l01464"></a>01464     <span class="keyword">typedef</span> <a class="code" href="classdb_1_1row.html" title="table rows interface">row</a> <a class="code" href="classdb_1_1row.html" title="table rows interface">_value_type</a>;
<a name="l01465"></a>01465     <span class="keyword">typedef</span> std::vector&lt;_value_type, alloc_row &gt; data_type;
<a name="l01466"></a>01466     <span class="keyword">typedef</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">_fvalue_type</a>;
<a name="l01467"></a>01467     <span class="keyword">typedef</span> std::vector&lt;_fvalue_type, alloc_field &gt; field_type;
<a name="l01468"></a>01468 
<a name="l01469"></a>01469     data_type _data;
<a name="l01470"></a>01470     field_type _field;
<a name="l01471"></a>01471     <a class="code" href="classdb_1_1base.html" title="datenbank interface">base</a>&amp; _base;
<a name="l01472"></a>01472     sqlite3_stmt* _stm; 
<a name="l01473"></a>01473 
<a name="l01474"></a>01474   <span class="keyword">public</span>:
<a name="l01475"></a>01475     <span class="keyword">typedef</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">_fvalue_type</a> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">fvalue_type</a>;
<a name="l01476"></a>01476     <span class="keyword">typedef</span> <a class="code" href="classdb_1_1row.html" title="table rows interface">_value_type</a> <a class="code" href="classdb_1_1row.html" title="table rows interface">value_type</a>;
<a name="l01477"></a>01477     <span class="keyword">typedef</span> data_type::reference reference;
<a name="l01478"></a>01478     <span class="keyword">typedef</span> data_type::const_reference const_reference;
<a name="l01479"></a>01479     <span class="keyword">typedef</span> data_type::size_type size_type;
<a name="l01480"></a>01480     <span class="keyword">typedef</span> data_type::difference_type difference_type;
<a name="l01481"></a>01481     <span class="keyword">typedef</span> data_type::iterator iterator;
<a name="l01482"></a>01482     <span class="keyword">typedef</span> data_type::const_iterator const_iterator;
<a name="l01483"></a>01483     <span class="keyword">typedef</span> field_type::iterator fiterator;
<a name="l01484"></a>01484     <span class="keyword">typedef</span> field_type::const_iterator const_fiterator;
<a name="l01485"></a>01485 
<a name="l01486"></a>01486     <a class="code" href="classdb_1_1query.html" title="cursor interface">query</a>(<a class="code" href="classdb_1_1base.html" title="datenbank interface">base</a>&amp; base_) : _base(base_), _stm(0)
<a name="l01487"></a>01487     {
<a name="l01488"></a>01488 
<a name="l01489"></a>01489     }
<a name="l01490"></a>01490 
<a name="l01491"></a>01491     <a class="code" href="classdb_1_1query.html" title="cursor interface">query</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1query.html" title="cursor interface">query</a>&amp; q) : _base(q._base), _stm(q._stm)
<a name="l01492"></a>01492     {
<a name="l01493"></a>01493       _data.reserve(q._data.size());
<a name="l01494"></a>01494       std::copy(q.<a class="code" href="classdb_1_1query.html#af04189ba182927ae38e06b0c391c7bd9" title="begin iterator">begin</a>(), q.<a class="code" href="classdb_1_1query.html#a4ec9e98aa7674fc35a46e44232f345d9" title="end iterator">end</a>(), std::back_inserter(_data));
<a name="l01495"></a>01495 
<a name="l01496"></a>01496       _field.reserve(q._field.size());
<a name="l01497"></a>01497       std::copy(q.<a class="code" href="classdb_1_1query.html#a991243f3583012bc919690f17b133836" title="begin iterator">fbegin</a>(), q.<a class="code" href="classdb_1_1query.html#a5da867ee5e9bcb45f801384b686b5377" title="end iterator">fend</a>(), std::back_inserter(_field));
<a name="l01498"></a>01498     }
<a name="l01499"></a>01499 
<a name="l01500"></a>01500     ~<a class="code" href="classdb_1_1query.html" title="cursor interface">query</a>() {}
<a name="l01501"></a>01501 
<a name="l01502"></a>01502     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classdb_1_1query.html#abd3023e4cb57d7b2ec61d34ef32c7f1e">execute</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; cmd);
<a name="l01503"></a><a class="code" href="classdb_1_1query.html#aeb35a38d5d57da68a38e633c70eb3785">01503</a> 
<a name="l01505"></a>01505     <span class="keyword">const</span> <a class="code" href="classdb_1_1row.html" title="table rows interface">row</a>&amp; <a class="code" href="classdb_1_1query.html#aeb35a38d5d57da68a38e633c70eb3785" title="get a row by number">getRow</a>(size_type row_num)<span class="keyword"> const </span>
<a name="l01506"></a>01506 <span class="keyword">    </span>{ 
<a name="l01507"></a>01507       <span class="keyword">const</span> <a class="code" href="classdb_1_1row.html" title="table rows interface">value_type</a>&amp; pValue(*(<a class="code" href="classdb_1_1query.html#af04189ba182927ae38e06b0c391c7bd9" title="begin iterator">begin</a>()+row_num));
<a name="l01508"></a>01508       <span class="keywordflow">return</span> pValue; 
<a name="l01509"></a>01509     }
<a name="l01510"></a>01510     <a class="code" href="classdb_1_1row.html" title="table rows interface">row</a>&amp; <a class="code" href="classdb_1_1query.html#aeb35a38d5d57da68a38e633c70eb3785" title="get a row by number">getRow</a>(size_type row_num) 
<a name="l01511"></a>01511     { 
<a name="l01512"></a>01512       value_type&amp; pValue(*(<a class="code" href="classdb_1_1query.html#af04189ba182927ae38e06b0c391c7bd9" title="begin iterator">begin</a>()+row_num));
<a name="l01513"></a>01513       <span class="keywordflow">return</span> pValue; 
<a name="l01514"></a>01514     }
<a name="l01515"></a><a class="code" href="classdb_1_1query.html#aab93c33e6352459b27d77c9e966fe5fb">01515</a> 
<a name="l01517"></a>01517     const_reference <a class="code" href="classdb_1_1query.html#aab93c33e6352459b27d77c9e966fe5fb" title="get a row by number">operator[] </a>(size_type row_num)<span class="keyword"> const </span>
<a name="l01518"></a>01518 <span class="keyword">    </span>{ <span class="keywordflow">return</span> *(<a class="code" href="classdb_1_1query.html#af04189ba182927ae38e06b0c391c7bd9" title="begin iterator">begin</a>()+row_num); }
<a name="l01519"></a>01519     reference <a class="code" href="classdb_1_1query.html#aab93c33e6352459b27d77c9e966fe5fb" title="get a row by number">operator[] </a>(size_type row_num) 
<a name="l01520"></a>01520     { <span class="keywordflow">return</span> *(<a class="code" href="classdb_1_1query.html#af04189ba182927ae38e06b0c391c7bd9" title="begin iterator">begin</a>()+row_num); }
<a name="l01521"></a><a class="code" href="classdb_1_1query.html#a2b9ae20086336a9573db2935ffe8b09b">01521</a> 
<a name="l01523"></a>01523     <span class="keywordtype">int</span> <a class="code" href="classdb_1_1query.html#a2b9ae20086336a9573db2935ffe8b09b" title="get id from field title">getIdOf</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; sField)<span class="keyword"> const  </span>
<a name="l01524"></a>01524 <span class="keyword">    </span>{ 
<a name="l01525"></a>01525       field_type::const_iterator iTB(_field.begin());
<a name="l01526"></a>01526       field_type::const_iterator iTE(_field.end());
<a name="l01527"></a>01527       <span class="keywordflow">for</span> (iTB;iTB!=iTE;++iTB)
<a name="l01528"></a>01528         <span class="keywordflow">if</span> (iTB-&gt;name()==sField)
<a name="l01529"></a>01529           <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(iTB-_field.begin());
<a name="l01530"></a>01530       <span class="keywordflow">return</span> -1;
<a name="l01531"></a>01531     }
<a name="l01532"></a>01532     <span class="keywordtype">string</span> getTitleOf(<span class="keywordtype">unsigned</span> iField)<span class="keyword"> const  </span>
<a name="l01533"></a>01533 <span class="keyword">    </span>{ 
<a name="l01534"></a>01534       <span class="keywordflow">if</span> (iField&lt;_field.size())
<a name="l01535"></a>01535         <span class="keywordflow">return</span> _field[iField].name();
<a name="l01536"></a>01536       <span class="keywordflow">else</span>
<a name="l01537"></a>01537         <span class="keywordflow">return</span> DB_TEXT(<span class="stringliteral">&quot;&quot;</span>);
<a name="l01538"></a>01538     }
<a name="l01539"></a>01539     <span class="keyword">const</span> field* getFieldInfo(<span class="keywordtype">unsigned</span> iField)<span class="keyword"> const  </span>
<a name="l01540"></a>01540 <span class="keyword">    </span>{ 
<a name="l01541"></a>01541       <span class="keywordflow">if</span> (iField&lt;_field.size())
<a name="l01542"></a>01542         <span class="keywordflow">return</span> &amp;_field[iField];
<a name="l01543"></a>01543       <span class="keywordflow">else</span>
<a name="l01544"></a>01544         <span class="keywordflow">return</span> 0;
<a name="l01545"></a>01545     }
<a name="l01546"></a><a class="code" href="classdb_1_1query.html#af04189ba182927ae38e06b0c391c7bd9">01546</a> 
<a name="l01548"></a><a class="code" href="classdb_1_1query.html#a4ec9e98aa7674fc35a46e44232f345d9">01548</a>     const_iterator <a class="code" href="classdb_1_1query.html#af04189ba182927ae38e06b0c391c7bd9" title="begin iterator">begin</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _data.begin(); }
<a name="l01550"></a><a class="code" href="classdb_1_1query.html#ac6b7b0eb991d0e4b63cb0d1be1254c41">01550</a>     const_iterator <a class="code" href="classdb_1_1query.html#a4ec9e98aa7674fc35a46e44232f345d9" title="end iterator">end</a>()<span class="keyword"> const   </span>{ <span class="keywordflow">return</span> _data.end(); }
<a name="l01552"></a><a class="code" href="classdb_1_1query.html#ac7b08bc8de0a9b154ce09bbe3704adbd">01552</a>     iterator <a class="code" href="classdb_1_1query.html#af04189ba182927ae38e06b0c391c7bd9" title="begin iterator">begin</a>()             { <span class="keywordflow">return</span> _data.begin(); }
<a name="l01554"></a><a class="code" href="classdb_1_1query.html#a991243f3583012bc919690f17b133836">01554</a>     iterator <a class="code" href="classdb_1_1query.html#a4ec9e98aa7674fc35a46e44232f345d9" title="end iterator">end</a>()               { <span class="keywordflow">return</span> _data.end(); }
<a name="l01556"></a><a class="code" href="classdb_1_1query.html#a5da867ee5e9bcb45f801384b686b5377">01556</a>     const_fiterator <a class="code" href="classdb_1_1query.html#a991243f3583012bc919690f17b133836" title="begin iterator">fbegin</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _field.begin(); }
<a name="l01558"></a><a class="code" href="classdb_1_1query.html#a2b6fb7c6f9f052b3fe27b36749a1eeee">01558</a>     const_fiterator <a class="code" href="classdb_1_1query.html#a5da867ee5e9bcb45f801384b686b5377" title="end iterator">fend</a>()<span class="keyword"> const   </span>{ <span class="keywordflow">return</span> _field.end(); }
<a name="l01560"></a><a class="code" href="classdb_1_1query.html#a77a501924192dc7e3154e5d9bca7d7cd">01560</a>     fiterator <a class="code" href="classdb_1_1query.html#a991243f3583012bc919690f17b133836" title="begin iterator">fbegin</a>()             { <span class="keywordflow">return</span> _field.begin(); }
<a name="l01562"></a><a class="code" href="classdb_1_1query.html#a355b15fc1d1aeb89b8a29e2a4b0a3154">01562</a>     fiterator <a class="code" href="classdb_1_1query.html#a5da867ee5e9bcb45f801384b686b5377" title="end iterator">fend</a>()               { <span class="keywordflow">return</span> _field.end(); }
<a name="l01564"></a><a class="code" href="classdb_1_1query.html#a9efe77499e15ac0a1465571a1f6cccf4">01564</a>     size_type <a class="code" href="classdb_1_1query.html#a355b15fc1d1aeb89b8a29e2a4b0a3154" title="container size">size</a>()<span class="keyword"> const         </span>{ <span class="keywordflow">return</span> _data.size(); }
<a name="l01566"></a>01566     <span class="keywordtype">bool</span> <a class="code" href="classdb_1_1query.html#a9efe77499e15ac0a1465571a1f6cccf4" title="is container empty?">empty</a>()<span class="keyword"> const             </span>{ <span class="keywordflow">return</span> _data.empty(); }
<a name="l01567"></a>01567     <span class="keywordtype">bool</span> f_empty()<span class="keyword"> const           </span>{ <span class="keywordflow">return</span> _field.empty(); }
<a name="l01568"></a>01568 
<a name="l01569"></a>01569     <span class="keywordtype">bool</span> operator==(<span class="keyword">const</span> query&amp; t)<span class="keyword"> const </span>
<a name="l01570"></a>01570 <span class="keyword">    </span>{ <span class="keywordflow">return</span>  _data == t._data; }
<a name="l01571"></a><a class="code" href="classdb_1_1query.html#a32d61fdfa75584aabccf4210a9c17084">01571</a> 
<a name="l01573"></a><a class="code" href="classdb_1_1query.html#a73c20d51276202e8d8f7b13e05319139">01573</a>     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1query.html#a73c20d51276202e8d8f7b13e05319139" title="push a field title to the field container">push_back</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1row.html" title="table rows interface">value_type</a>&amp; v)  { _data.push_back(v); }
<a name="l01575"></a>01575     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1query.html#a32d61fdfa75584aabccf4210a9c17084" title="push a row to the row container">push_back</a>(<span class="keyword">const</span> fvalue_type&amp; v)  { _field.push_back(v); }
<a name="l01576"></a>01576   };
<a name="l01577"></a>01577 
<a name="l01578"></a>01578   <span class="keyword">typedef</span> boost::shared_ptr&lt;query&gt; query_ptr;
<a name="l01579"></a><a class="code" href="classdb_1_1sel.html">01579</a> 
<a name="l01581"></a>01581   <span class="keyword">class </span><a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> 
<a name="l01582"></a>01582   {
<a name="l01583"></a>01583   <span class="keyword">protected</span>:
<a name="l01584"></a>01584     <span class="keywordtype">bool</span> _distinct;
<a name="l01585"></a>01585     <span class="keywordtype">int</span> _limit;
<a name="l01586"></a>01586     <span class="keywordtype">int</span> _offset;
<a name="l01587"></a>01587     split _results;
<a name="l01588"></a>01588     split _sources;
<a name="l01589"></a>01589     split _groupBy;
<a name="l01590"></a>01590     split _orderBy;
<a name="l01591"></a>01591 
<a name="l01592"></a>01592     <span class="keywordtype">string</span> _where; 
<a name="l01593"></a>01593     <span class="keywordtype">string</span> _having;
<a name="l01594"></a>01594     <span class="keywordtype">string</span> _delim1;
<a name="l01595"></a>01595     <span class="keywordtype">string</span> _delim2;
<a name="l01596"></a>01596     field_pair _join;
<a name="l01597"></a>01597 
<a name="l01598"></a>01598   <span class="keyword">public</span>:
<a name="l01608"></a>01608     <a class="code" href="classdb_1_1sel.html#a04b3051f6a5a229b2c1d8d018de272f0" title="sel">sel</a>() : _distinct(<span class="keyword">false</span>), _limit(0), _offset(0), 
<a name="l01609"></a>01609       _where(DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>)), _delim1(DB_TEXT(<span class="stringliteral">&quot;&quot;</span>)), _delim2(DB_TEXT(<span class="stringliteral">&quot;&quot;</span>))
<a name="l01610"></a>01610     {}
<a name="l01611"></a>01611 
<a name="l01622"></a>01622     <a class="code" href="classdb_1_1sel.html#a04b3051f6a5a229b2c1d8d018de272f0" title="sel">sel</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; tablename) : _distinct(<span class="keyword">false</span>), _limit(0), _offset(0), 
<a name="l01623"></a>01623       _where(DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>)), _delim1(DB_TEXT(<span class="stringliteral">&quot;&quot;</span>)), _delim2(DB_TEXT(<span class="stringliteral">&quot;&quot;</span>))
<a name="l01624"></a>01624     { <a class="code" href="classdb_1_1sel.html#a9cacf70fd3820fd86c12cd253e32dcdd" title="source">source</a>(tablename); }
<a name="l01625"></a>01625 
<a name="l01637"></a>01637     <a class="code" href="classdb_1_1sel.html#a04b3051f6a5a229b2c1d8d018de272f0" title="sel">sel</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; tablename, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; delim) : _distinct(<span class="keyword">false</span>), 
<a name="l01638"></a>01638       _limit(0), _offset(0), _where(DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>)), _delim1(delim), 
<a name="l01639"></a>01639       _delim2(delim)
<a name="l01640"></a>01640     { <a class="code" href="classdb_1_1sel.html#a9cacf70fd3820fd86c12cd253e32dcdd" title="source">source</a>(tablename); }
<a name="l01641"></a>01641 
<a name="l01654"></a>01654     <a class="code" href="classdb_1_1sel.html#a04b3051f6a5a229b2c1d8d018de272f0" title="sel">sel</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; tablename, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; delim1, 
<a name="l01655"></a>01655       <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; delim2) : _distinct(<span class="keyword">false</span>), 
<a name="l01656"></a>01656       _limit(0), _offset(0), _where(DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>)), _delim1(delim1), 
<a name="l01657"></a>01657       _delim2(delim2)
<a name="l01658"></a>01658     { <a class="code" href="classdb_1_1sel.html#a9cacf70fd3820fd86c12cd253e32dcdd" title="source">source</a>(tablename); }
<a name="l01659"></a>01659 
<a name="l01668"></a>01668     <a class="code" href="classdb_1_1sel.html#a04b3051f6a5a229b2c1d8d018de272f0" title="sel">sel</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a>&amp; s) : _distinct(s._distinct), _limit(s._limit),
<a name="l01669"></a>01669       _offset(s._offset), _where(s._where), _having(s._having),
<a name="l01670"></a>01670       _delim1(s._delim1), _delim2(s._delim2), _results(s._results),
<a name="l01671"></a>01671       _sources(s._sources), _groupBy(s._groupBy), _orderBy(s._orderBy),
<a name="l01672"></a>01672       _join(s._join)
<a name="l01673"></a>01673     {
<a name="l01674"></a>01674     }
<a name="l01675"></a>01675 
<a name="l01684"></a>01684     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html#adc0a7ae7baafaa8b73fcd1a89647cf64" title="~sel">~sel</a>() {}
<a name="l01685"></a>01685 
<a name="l01694"></a>01694     <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a3f9d11583a52bc5158f99a353b74a09e" title="operator=">operator=</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a>&amp; s)
<a name="l01695"></a>01695     { 
<a name="l01696"></a>01696       _distinct = s._distinct;
<a name="l01697"></a>01697       _limit = s._limit;
<a name="l01698"></a>01698       _offset = s._offset;
<a name="l01699"></a>01699       _results = s._results;
<a name="l01700"></a>01700       _sources = s._sources;
<a name="l01701"></a>01701       _groupBy = s._groupBy;
<a name="l01702"></a>01702       _orderBy = s._orderBy;
<a name="l01703"></a>01703 
<a name="l01704"></a>01704       _where = s._where; 
<a name="l01705"></a>01705       _having = s._having;
<a name="l01706"></a>01706       _delim1 = s._delim1;
<a name="l01707"></a>01707       _delim2 = s._delim2;
<a name="l01708"></a>01708       _join = s._join;
<a name="l01709"></a>01709 
<a name="l01710"></a>01710       <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
<a name="l01711"></a>01711     }
<a name="l01712"></a>01712 
<a name="l01722"></a>01722     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#acff2d7c1ca3d9f57b153b4e08e18e77d" title=",">operator,</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s)
<a name="l01723"></a>01723     { <span class="keywordflow">return</span> this-&gt;<a class="code" href="classdb_1_1sel.html#a715e65c2ad605e8d62706801dabdd3dd" title="result">result</a>(s); }
<a name="l01724"></a>01724 
<a name="l01734"></a>01734     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a683f2a8528c44915aeeb2cb2c02a1f8b" title="operator%">operator%</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">expr::base</a>&amp; e)
<a name="l01735"></a>01735     { <span class="keywordflow">return</span> this-&gt;<a class="code" href="classdb_1_1sel.html#a39325321609012af904aaf68ea6f807f" title="where">where</a>(e.<a class="code" href="classdb_1_1expr_1_1base.html#aa44ea1ee8e44ece8ec2facb14c64456f" title="default expression is true">str</a>()); }
<a name="l01736"></a>01736 
<a name="l01746"></a>01746     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a8afb154fa90211aa4276292df8b6e5c2" title="operator&amp;lt;">operator&lt;</a>(<span class="keyword">const</span> field_pair&amp; f)
<a name="l01747"></a>01747     { <span class="keywordflow">return</span> this-&gt;<a class="code" href="classdb_1_1sel.html#ad748ca7b03d060eb59e45b92bba6f741" title="join">join</a>(f); }
<a name="l01748"></a>01748 
<a name="l01758"></a>01758     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#af2a54457a0dda9c26c6f72a783759332" title="distinct">distinct</a>(<span class="keywordtype">bool</span> d) 
<a name="l01759"></a>01759     { 
<a name="l01760"></a>01760       _distinct = d; 
<a name="l01761"></a>01761       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01762"></a>01762     }
<a name="l01763"></a>01763 
<a name="l01773"></a>01773     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a6f472b01477e7cd0246fffd84ff8c8b3" title="limit">limit</a>(<span class="keywordtype">int</span> value)
<a name="l01774"></a>01774     { 
<a name="l01775"></a>01775       _limit = value;   
<a name="l01776"></a>01776       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01777"></a>01777     }
<a name="l01778"></a>01778 
<a name="l01788"></a>01788     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#ad748ca7b03d060eb59e45b92bba6f741" title="join">join</a>(<span class="keyword">const</span> field_pair&amp; f)
<a name="l01789"></a>01789     { 
<a name="l01790"></a>01790       _join = f;    
<a name="l01791"></a>01791       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01792"></a>01792     }
<a name="l01793"></a>01793 
<a name="l01803"></a>01803     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a76cd4be22d953600326a46d9e012e1ae" title="offset">offset</a>(<span class="keywordtype">int</span> value)
<a name="l01804"></a>01804     { 
<a name="l01805"></a>01805       _offset = value; 
<a name="l01806"></a>01806       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01807"></a>01807     }
<a name="l01808"></a>01808 
<a name="l01819"></a>01819     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a89d8b072994ad2b55e24fdeb52e00c76" title="result_no_delim">result_no_delim</a>(<span class="keywordtype">string</span> r, <span class="keywordtype">string</span> alias=DB_TEXT(<span class="stringliteral">&quot;&quot;</span>))
<a name="l01820"></a>01820     { 
<a name="l01821"></a>01821       <span class="keywordflow">if</span> (alias.length())
<a name="l01822"></a>01822         r += DB_TEXT(<span class="stringliteral">&quot; AS &quot;</span>) + alias;
<a name="l01823"></a>01823       _results.push_back(r); 
<a name="l01824"></a>01824       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01825"></a>01825     }
<a name="l01826"></a>01826 
<a name="l01837"></a>01837     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a715e65c2ad605e8d62706801dabdd3dd" title="result">result</a>(<span class="keywordtype">string</span> r, <span class="keywordtype">string</span> alias=DB_TEXT(<span class="stringliteral">&quot;&quot;</span>))
<a name="l01838"></a>01838     { 
<a name="l01839"></a>01839       <span class="keywordflow">if</span> (alias.length())
<a name="l01840"></a>01840         r += DB_TEXT(<span class="stringliteral">&quot; AS &quot;</span>) + alias;
<a name="l01841"></a>01841       <span class="keywordflow">if</span> (r!=DB_TEXT(<span class="stringliteral">&quot;*&quot;</span>)) 
<a name="l01842"></a>01842         detail::front_back_delim(r, _delim1, _delim2);
<a name="l01843"></a>01843       _results.push_back(r); 
<a name="l01844"></a>01844       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01845"></a>01845     }
<a name="l01846"></a>01846 
<a name="l01857"></a>01857     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#aabb188e31b0f7ed1d6b8254ff6bc2a20" title="result_max">result_max</a>(<span class="keywordtype">string</span> r, <span class="keywordtype">string</span> alias=DB_TEXT(<span class="stringliteral">&quot;&quot;</span>))
<a name="l01858"></a>01858     { 
<a name="l01859"></a>01859       r = DB_TEXT(<span class="stringliteral">&quot;MAX(&quot;</span>)+r;
<a name="l01860"></a>01860       r += DB_TEXT(<span class="stringliteral">&quot;)&quot;</span>);
<a name="l01861"></a>01861       <span class="keywordflow">if</span> (r!=DB_TEXT(<span class="stringliteral">&quot;*&quot;</span>)) 
<a name="l01862"></a>01862         detail::front_back_delim(r, _delim1, _delim2);
<a name="l01863"></a>01863       <span class="keywordflow">if</span> (alias.length())
<a name="l01864"></a>01864       {
<a name="l01865"></a>01865         detail::front_back_delim(alias, _delim1, _delim2);
<a name="l01866"></a>01866         r += DB_TEXT(<span class="stringliteral">&quot; AS &quot;</span>) + alias;
<a name="l01867"></a>01867       }
<a name="l01868"></a>01868       _results.push_back(r); 
<a name="l01869"></a>01869       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01870"></a>01870     }
<a name="l01871"></a>01871 
<a name="l01880"></a>01880     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a1ce0ac7fcaf39aeb286cc8ebedec5fdd" title="clear">clear</a>()
<a name="l01881"></a>01881     {
<a name="l01882"></a>01882       _results.clear();
<a name="l01883"></a>01883       _sources.clear();
<a name="l01884"></a>01884       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01885"></a>01885     }
<a name="l01886"></a>01886 
<a name="l01897"></a>01897     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a9cacf70fd3820fd86c12cd253e32dcdd" title="source">source</a>(<span class="keywordtype">string</span> s, <span class="keywordtype">string</span> alias=DB_TEXT(<span class="stringliteral">&quot;&quot;</span>))
<a name="l01898"></a>01898     {
<a name="l01899"></a>01899       detail::front_back_delim(s, _delim1, _delim2);
<a name="l01900"></a>01900       <span class="keywordflow">if</span> (alias.length())
<a name="l01901"></a>01901       {
<a name="l01902"></a>01902         detail::front_back_delim(alias, _delim1, _delim2);
<a name="l01903"></a>01903         s += DB_TEXT(<span class="stringliteral">&quot; AS &quot;</span>) + alias;
<a name="l01904"></a>01904       }
<a name="l01905"></a>01905       _sources.push_back(s);
<a name="l01906"></a>01906       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01907"></a>01907     }
<a name="l01908"></a>01908 
<a name="l01918"></a>01918     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a39325321609012af904aaf68ea6f807f" title="where">where</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">expr::base</a> &amp; w)
<a name="l01919"></a>01919     { 
<a name="l01920"></a>01920       _where = expr::and_(expr::raw(_where), w).str();  
<a name="l01921"></a>01921       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01922"></a>01922     }
<a name="l01923"></a>01923 
<a name="l01933"></a>01933     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a39325321609012af904aaf68ea6f807f" title="where">where</a>(<span class="keywordtype">string</span> w)
<a name="l01934"></a>01934     { 
<a name="l01935"></a>01935       _where = expr::and_(expr::raw(_where), expr::raw(w)).str();
<a name="l01936"></a>01936       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01937"></a>01937     }
<a name="l01938"></a>01938 
<a name="l01948"></a>01948     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a6b1c1370be90dd5eb25aae1d9ddd883e" title="group_by">group_by</a>(<span class="keywordtype">string</span> gb)
<a name="l01949"></a>01949     { 
<a name="l01950"></a>01950       detail::front_back_delim(gb, _delim1, _delim2);
<a name="l01951"></a>01951       _groupBy.push_back(gb);   
<a name="l01952"></a>01952       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01953"></a>01953     }
<a name="l01954"></a>01954 
<a name="l01964"></a>01964     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a018a98d838fd8dc2e0e2955174cb20ef" title="having">having</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">expr::base</a> &amp; h)
<a name="l01965"></a>01965     { 
<a name="l01966"></a>01966       _having = h.<a class="code" href="classdb_1_1expr_1_1base.html#aa44ea1ee8e44ece8ec2facb14c64456f" title="default expression is true">str</a>(); 
<a name="l01967"></a>01967       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01968"></a>01968     }
<a name="l01969"></a>01969 
<a name="l01979"></a>01979     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#a018a98d838fd8dc2e0e2955174cb20ef" title="having">having</a>(<span class="keywordtype">string</span> h)
<a name="l01980"></a>01980     { 
<a name="l01981"></a>01981       _having = h;
<a name="l01982"></a>01982       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01983"></a>01983     }
<a name="l01984"></a>01984 
<a name="l01995"></a>01995     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a> &amp; <a class="code" href="classdb_1_1sel.html#afc70a6bbfad91f19d3b4fb52dbe16391" title="order_by">order_by</a>(<span class="keywordtype">string</span> ob, <span class="keywordtype">bool</span> ascending=<span class="keyword">true</span>)
<a name="l01996"></a>01996     { 
<a name="l01997"></a>01997       <span class="keywordtype">string</span> value = ob;
<a name="l01998"></a>01998       detail::front_back_delim(value, _delim1, _delim2);
<a name="l01999"></a>01999       <span class="keywordflow">if</span> (!ascending)
<a name="l02000"></a>02000         value += DB_TEXT(<span class="stringliteral">&quot; DESC&quot;</span>);
<a name="l02001"></a>02001       _orderBy.push_back(value); 
<a name="l02002"></a>02002       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02003"></a>02003     }
<a name="l02004"></a>02004 
<a name="l02013"></a>02013     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1sel.html#a2c3c2e434060a255d6546be26f3c74b6" title="operator string">operator string</a>()<span class="keyword"> const</span>
<a name="l02014"></a>02014 <span class="keyword">    </span>{
<a name="l02015"></a>02015       ostringstream res;
<a name="l02016"></a>02016       res &lt;&lt; DB_TEXT(<span class="stringliteral">&quot;SELECT &quot;</span>);
<a name="l02017"></a>02017       <span class="keywordflow">if</span> (_distinct)
<a name="l02018"></a>02018         res &lt;&lt; DB_TEXT(<span class="stringliteral">&quot;DISTINCT &quot;</span>);
<a name="l02019"></a>02019       res &lt;&lt; _results.join(DB_TEXT(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l02020"></a>02020       res &lt;&lt; DB_TEXT(<span class="stringliteral">&quot; FROM &quot;</span>);
<a name="l02021"></a>02021       res &lt;&lt; _sources.join(DB_TEXT(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l02022"></a>02022       
<a name="l02023"></a>02023       <span class="keywordflow">if</span> (_join.first.table().length()!=0 &amp;&amp; 
<a name="l02024"></a>02024           _join.second.table().length()!=0 &amp;&amp; 
<a name="l02025"></a>02025           _sources.size()==1)
<a name="l02026"></a>02026         res &lt;&lt; DB_TEXT(<span class="stringliteral">&quot; INNER JOIN &quot;</span>) &lt;&lt; _join.first.table() &lt;&lt; DB_TEXT(<span class="stringliteral">&quot; ON &quot;</span>) &lt;&lt; 
<a name="l02027"></a>02027           _join.first.fullName() &lt;&lt; DB_TEXT(<span class="stringliteral">&quot; = &quot;</span>) &lt;&lt; _join.second.fullName() &lt;&lt; 
<a name="l02028"></a>02028           DB_TEXT(<span class="stringliteral">&quot; &quot;</span>);
<a name="l02029"></a>02029       
<a name="l02030"></a>02030       <span class="keywordflow">if</span> (_where != DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>))
<a name="l02031"></a>02031         res &lt;&lt; DB_TEXT(<span class="stringliteral">&quot; WHERE &quot;</span>) &lt;&lt; _where;
<a name="l02032"></a>02032       <span class="keywordflow">if</span> (_groupBy.size() &gt; 0)
<a name="l02033"></a>02033         res &lt;&lt; DB_TEXT(<span class="stringliteral">&quot; GROUP BY &quot;</span>) &lt;&lt; _groupBy.join(DB_TEXT(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l02034"></a>02034       <span class="keywordflow">if</span> (_having.length())
<a name="l02035"></a>02035         res &lt;&lt; DB_TEXT(<span class="stringliteral">&quot; HAVING &quot;</span>) &lt;&lt; _having;
<a name="l02036"></a>02036       <span class="keywordflow">if</span> (_orderBy.size() &gt; 0)
<a name="l02037"></a>02037         res &lt;&lt; DB_TEXT(<span class="stringliteral">&quot; ORDER BY &quot;</span>) &lt;&lt; _orderBy.join(DB_TEXT(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l02038"></a>02038       <span class="keywordflow">if</span> (_limit) 
<a name="l02039"></a>02039         res &lt;&lt; DB_TEXT(<span class="stringliteral">&quot; LIMIT &quot;</span>) &lt;&lt; string(detail::to_string(_limit));
<a name="l02040"></a>02040       <span class="keywordflow">if</span> (_offset) 
<a name="l02041"></a>02041         res &lt;&lt; DB_TEXT(<span class="stringliteral">&quot; OFFSET &quot;</span>) &lt;&lt; string(detail::to_string(_offset));
<a name="l02042"></a>02042 
<a name="l02043"></a>02043       <span class="keywordtype">string</span> ret(res.str());
<a name="l02044"></a>02044       detail::replace_all(ret, _delim1+_delim1, _delim1);
<a name="l02045"></a>02045       <span class="keywordflow">if</span> (_delim1!=_delim2)
<a name="l02046"></a>02046         detail::replace_all(ret, _delim2+_delim2, _delim2);
<a name="l02047"></a>02047       <span class="keywordflow">return</span> ret;
<a name="l02048"></a>02048     }
<a name="l02049"></a>02049 
<a name="l02058"></a>02058     <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classdb_1_1sel.html#a732971616dc4429f60ee6f0cc580fe05" title="str">str</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> this-&gt;<a class="code" href="classdb_1_1sel.html#a2c3c2e434060a255d6546be26f3c74b6" title="operator string">operator string</a>(); }
<a name="l02059"></a>02059   }; 
<a name="l02060"></a><a class="code" href="classdb_1_1del.html">02060</a> 
<a name="l02062"></a>02062   <span class="keyword">class </span><a class="code" href="classdb_1_1del.html" title="helper class, generates DELETE SQL statements">del</a> : <span class="keyword">public</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a>
<a name="l02063"></a>02063   {
<a name="l02064"></a>02064   <span class="keyword">public</span>:
<a name="l02065"></a>02065     <a class="code" href="classdb_1_1del.html" title="helper class, generates DELETE SQL statements">del</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; tablename) : <a class="code" href="classdb_1_1sel.html#a04b3051f6a5a229b2c1d8d018de272f0" title="sel">sel</a>(tablename) { }
<a name="l02066"></a>02066 
<a name="l02075"></a>02075     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1del.html#a744b2812bef236702bb79c66161ad78c" title="operator string">operator string</a>()<span class="keyword"> const</span>
<a name="l02076"></a>02076 <span class="keyword">    </span>{
<a name="l02077"></a>02077       <span class="keywordtype">string</span> res = DB_TEXT(<span class="stringliteral">&quot;DELETE FROM &quot;</span>);
<a name="l02078"></a>02078       res += _sources.join(DB_TEXT(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l02079"></a>02079       <span class="keywordflow">if</span> (_where != DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>))
<a name="l02080"></a>02080         res += DB_TEXT(<span class="stringliteral">&quot; WHERE &quot;</span>) + _where;
<a name="l02081"></a>02081       <span class="keywordflow">if</span> (_groupBy.size() &gt; 0)
<a name="l02082"></a>02082         res += DB_TEXT(<span class="stringliteral">&quot; GROUP BY &quot;</span>) + _groupBy.join(DB_TEXT(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l02083"></a>02083       <span class="keywordflow">if</span> (_having.length())
<a name="l02084"></a>02084         res += DB_TEXT(<span class="stringliteral">&quot; HAVING &quot;</span>) + _having;
<a name="l02085"></a>02085       <span class="keywordflow">if</span> (_orderBy.size() &gt; 0)
<a name="l02086"></a>02086         res += DB_TEXT(<span class="stringliteral">&quot; ORDER BY &quot;</span>) + _orderBy.join(DB_TEXT(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l02087"></a>02087       <span class="keywordflow">if</span> (_limit) 
<a name="l02088"></a>02088         res += DB_TEXT(<span class="stringliteral">&quot; LIMIT &quot;</span>) + string(detail::to_string(_limit));
<a name="l02089"></a>02089       <span class="keywordflow">if</span> (_offset) 
<a name="l02090"></a>02090         res += DB_TEXT(<span class="stringliteral">&quot; OFFSET &quot;</span>) + string(detail::to_string(_offset));
<a name="l02091"></a>02091 
<a name="l02092"></a>02092       detail::replace_all(res, _delim1+_delim1, _delim1);
<a name="l02093"></a>02093       <span class="keywordflow">if</span> (_delim1!=_delim2)
<a name="l02094"></a>02094         detail::replace_all(res, _delim2+_delim2, _delim2);
<a name="l02095"></a>02095       <span class="keywordflow">return</span> res;
<a name="l02096"></a>02096     }
<a name="l02097"></a>02097 
<a name="l02106"></a>02106     <span class="keyword">virtual</span> <a class="code" href="classdb_1_1del.html#ae14834a21d6f451f4a115e284835cae8" title="~del">~del</a>() {}
<a name="l02107"></a>02107   };
<a name="l02108"></a><a class="code" href="classdb_1_1ins.html">02108</a> 
<a name="l02110"></a>02110   <span class="keyword">class </span><a class="code" href="classdb_1_1ins.html" title="helper class, generates INSERT SQL statements">ins</a> 
<a name="l02111"></a>02111   {
<a name="l02112"></a>02112   <span class="keyword">protected</span>:
<a name="l02113"></a>02113     split_map _values;
<a name="l02114"></a>02114     <span class="keywordtype">string</span>    _source;
<a name="l02115"></a>02115     <span class="keywordtype">string</span>    _delim1;
<a name="l02116"></a>02116     <span class="keywordtype">string</span>    _delim2;
<a name="l02117"></a>02117 
<a name="l02118"></a>02118   <span class="keyword">public</span>:
<a name="l02128"></a>02128     <a class="code" href="classdb_1_1ins.html#a4b26aa8c7d27c76bcd357b12522cf31d" title="ins">ins</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; tab) : _source(tab) 
<a name="l02129"></a>02129     {}
<a name="l02130"></a>02130 
<a name="l02141"></a>02141     <a class="code" href="classdb_1_1ins.html#a4b26aa8c7d27c76bcd357b12522cf31d" title="ins">ins</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; tab, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; delim) : _source(tab), 
<a name="l02142"></a>02142       _delim1(delim), _delim2(delim) 
<a name="l02143"></a>02143     {}
<a name="l02144"></a>02144 
<a name="l02156"></a>02156     <a class="code" href="classdb_1_1ins.html#a4b26aa8c7d27c76bcd357b12522cf31d" title="ins">ins</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; tab, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; delim1, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; delim2) : 
<a name="l02157"></a>02157       _source(tab), _delim1(delim1), _delim2(delim2) 
<a name="l02158"></a>02158     {}
<a name="l02159"></a>02159     
<a name="l02168"></a>02168     <a class="code" href="classdb_1_1ins.html#a0561f59b43cfceb6ac7c3ebf27b215a6" title="~ins">~ins</a>() {}
<a name="l02169"></a>02169     
<a name="l02178"></a>02178     <a class="code" href="classdb_1_1ins.html" title="helper class, generates INSERT SQL statements">ins</a> &amp; <a class="code" href="classdb_1_1ins.html#a178271be1c1700619f221a3f651d46c0" title="clear_values">clear_values</a>()
<a name="l02179"></a>02179     {
<a name="l02180"></a>02180       _values.clear();
<a name="l02181"></a>02181       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02182"></a>02182     }
<a name="l02183"></a>02183 
<a name="l02193"></a>02193     <a class="code" href="classdb_1_1ins.html" title="helper class, generates INSERT SQL statements">ins</a> &amp; <a class="code" href="classdb_1_1ins.html#a932bc974163d80fc9dd102ffd44261fa" title="operator%">operator%</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a>&amp; f)
<a name="l02194"></a>02194     { 
<a name="l02195"></a>02195       <span class="keywordflow">if</span> (f.<a class="code" href="classdb_1_1field.html#abd933ffca0d086a69e0024bc72da5229" title="values">values</a>().size()==1)
<a name="l02196"></a>02196         <span class="keywordflow">return</span> <a class="code" href="classdb_1_1ins.html#a4cd11e9a5523b9f7178d494765f0ae38" title="values">values</a>(f.name(), f.<a class="code" href="classdb_1_1field.html#abd933ffca0d086a69e0024bc72da5229" title="values">values</a>().begin()-&gt;second, f.type());
<a name="l02197"></a>02197       <span class="keywordflow">else</span>
<a name="l02198"></a>02198         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02199"></a>02199     }
<a name="l02200"></a>02200 
<a name="l02211"></a>02211     <a class="code" href="classdb_1_1ins.html" title="helper class, generates INSERT SQL statements">ins</a> &amp; <a class="code" href="classdb_1_1ins.html#a4cd11e9a5523b9f7178d494765f0ae38" title="values">values</a>(<span class="keywordtype">string</span> t, <a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a>* v)
<a name="l02212"></a>02212     {
<a name="l02213"></a>02213       <span class="keywordtype">string</span> sV(v-&gt;<a class="code" href="classdb_1_1param.html#a66a7cbc5eaeb5d9c70f808304beaf786">str</a>());
<a name="l02214"></a>02214       <span class="keywordflow">if</span> (sV.length()==0)
<a name="l02215"></a>02215         sV = DB_TEXT(<span class="stringliteral">&quot;NULL&quot;</span>);
<a name="l02216"></a>02216       <span class="keywordflow">else</span>
<a name="l02217"></a>02217         <span class="keywordflow">switch</span>(v-&gt;<a class="code" href="classdb_1_1param.html#adf04bb15daefada541c37dee2bafba02">get_type</a>()) 
<a name="l02218"></a>02218       {
<a name="l02219"></a>02219         <span class="keywordflow">case</span> e_string:
<a name="l02220"></a>02220         <span class="keywordflow">case</span> e_date_time:
<a name="l02221"></a>02221           sV = DB_TEXT(<span class="stringliteral">&quot;&#39;&quot;</span>) + sV;
<a name="l02222"></a>02222           sV += DB_TEXT(<span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l02223"></a>02223           <span class="keywordflow">break</span>;
<a name="l02224"></a>02224       }
<a name="l02225"></a>02225       detail::front_back_delim(t, _delim1, _delim2);
<a name="l02226"></a>02226       _values.insert(std::pair&lt;string, string&gt;(t, sV));
<a name="l02227"></a>02227       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02228"></a>02228     }
<a name="l02229"></a>02229 
<a name="l02241"></a>02241     <a class="code" href="classdb_1_1ins.html" title="helper class, generates INSERT SQL statements">ins</a> &amp; <a class="code" href="classdb_1_1ins.html#a4cd11e9a5523b9f7178d494765f0ae38" title="values">values</a>(<span class="keywordtype">string</span> t, <span class="keywordtype">string</span> v, param_types p=e_int)
<a name="l02242"></a>02242     {
<a name="l02243"></a>02243       <span class="keywordflow">switch</span>(p) 
<a name="l02244"></a>02244       {
<a name="l02245"></a>02245       <span class="keywordflow">case</span> e_char:
<a name="l02246"></a>02246       <span class="keywordflow">case</span> e_blob:
<a name="l02247"></a>02247       <span class="keywordflow">case</span> e_string:
<a name="l02248"></a>02248       <span class="keywordflow">case</span> e_date_time:
<a name="l02249"></a>02249         detail::erase_all&lt;string&gt;(v, DB_TEXT(<span class="stringliteral">&quot;&#39;&quot;</span>));
<a name="l02250"></a>02250         detail::erase_all&lt;string&gt;(v, DB_TEXT(<span class="stringliteral">&quot;`&quot;</span>));
<a name="l02251"></a>02251         detail::erase_all&lt;string&gt;(v, DB_TEXT(<span class="stringliteral">&quot;Â´&quot;</span>));
<a name="l02252"></a>02252         v = DB_TEXT(<span class="stringliteral">&quot;&#39;&quot;</span>) + v;
<a name="l02253"></a>02253         v += DB_TEXT(<span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l02254"></a>02254         <span class="keywordflow">break</span>;
<a name="l02255"></a>02255       }
<a name="l02256"></a>02256       detail::front_back_delim(t, _delim1, _delim2);
<a name="l02257"></a>02257       _values.insert(std::pair&lt;string, string&gt;(t, v));
<a name="l02258"></a>02258       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02259"></a>02259     }
<a name="l02260"></a>02260 
<a name="l02271"></a>02271     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l02272"></a>02272     <a class="code" href="classdb_1_1ins.html" title="helper class, generates INSERT SQL statements">ins</a> &amp; <a class="code" href="classdb_1_1ins.html#a4cd11e9a5523b9f7178d494765f0ae38" title="values">values</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; t, <span class="keyword">const</span> T&amp; v)
<a name="l02273"></a>02273     { <span class="keywordflow">return</span> <a class="code" href="classdb_1_1ins.html#a4cd11e9a5523b9f7178d494765f0ae38" title="values">values</a>(t, detail::to_string(v), tp(v)); }
<a name="l02274"></a>02274 
<a name="l02283"></a>02283     <a class="code" href="classdb_1_1ins.html#adada9d805c97782a7e8295b7b07e5286" title="operator string">operator string</a>()<span class="keyword"> const</span>
<a name="l02284"></a>02284 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classdb_1_1ins.html#a7ed9cc3fc6a1c3c31bdab1361e477471" title="str">str</a>(); }
<a name="l02285"></a>02285 
<a name="l02294"></a>02294     <span class="keywordtype">string</span> <a class="code" href="classdb_1_1ins.html#a7ed9cc3fc6a1c3c31bdab1361e477471" title="str">str</a>()<span class="keyword"> const </span>
<a name="l02295"></a>02295 <span class="keyword">    </span>{       
<a name="l02296"></a>02296       <span class="keywordtype">string</span> res = DB_TEXT(<span class="stringliteral">&quot;INSERT INTO &quot;</span>);
<a name="l02297"></a>02297       res += _source;
<a name="l02298"></a>02298 
<a name="l02299"></a>02299       <span class="keywordflow">if</span> (_values.size() &gt; 0)
<a name="l02300"></a>02300       {
<a name="l02301"></a>02301         res += DB_TEXT(<span class="stringliteral">&quot; (&quot;</span>);
<a name="l02302"></a>02302         res += _values.join_fields(DB_TEXT(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l02303"></a>02303         res += DB_TEXT(<span class="stringliteral">&quot;) VALUES (&quot;</span>);
<a name="l02304"></a>02304         res += _values.join_values(DB_TEXT(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l02305"></a>02305         res += DB_TEXT(<span class="stringliteral">&quot;)&quot;</span>);
<a name="l02306"></a>02306       }
<a name="l02307"></a>02307       <span class="keywordflow">return</span> res;
<a name="l02308"></a>02308     }
<a name="l02309"></a>02309   }; 
<a name="l02310"></a><a class="code" href="classdb_1_1upd.html">02310</a> 
<a name="l02312"></a>02312   <span class="keyword">class </span><a class="code" href="classdb_1_1upd.html" title="hilft beim anlegen von UPDATE-SQL AusdrÃ¼cken.">upd</a> 
<a name="l02313"></a>02313   {
<a name="l02314"></a>02314     <span class="keywordtype">string</span> _delim1;
<a name="l02315"></a>02315     <span class="keywordtype">string</span> _delim2;
<a name="l02316"></a>02316     <span class="keywordtype">string</span> table;
<a name="l02317"></a>02317     <span class="keywordtype">string</span> _where;
<a name="l02318"></a>02318     split fields;
<a name="l02319"></a>02319     split values;
<a name="l02320"></a>02320   <span class="keyword">public</span>:
<a name="l02329"></a>02329     <a class="code" href="classdb_1_1upd.html#a2d703993121faf84587b74fb293a197f" title="~upd">~upd</a>() 
<a name="l02330"></a>02330     { }
<a name="l02331"></a>02331 
<a name="l02341"></a>02341     <a class="code" href="classdb_1_1upd.html#a89539569559a82ce11a99fc5e2797c8d" title="upd">upd</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; t) : table(t), _where(DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>)) 
<a name="l02342"></a>02342     { }
<a name="l02343"></a>02343 
<a name="l02354"></a>02354     <a class="code" href="classdb_1_1upd.html#a89539569559a82ce11a99fc5e2797c8d" title="upd">upd</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; t, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; d) : table(t), 
<a name="l02355"></a>02355       _where(DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>)), _delim1(d), _delim2(d) 
<a name="l02356"></a>02356     { }
<a name="l02357"></a>02357 
<a name="l02369"></a>02369     <a class="code" href="classdb_1_1upd.html#a89539569559a82ce11a99fc5e2797c8d" title="upd">upd</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; t, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; d1, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; d2) : table(t), 
<a name="l02370"></a>02370       _where(DB_TEXT(<span class="stringliteral">&quot;True&quot;</span>)), _delim1(d1), _delim2(d2) 
<a name="l02371"></a>02371     { }
<a name="l02372"></a>02372 
<a name="l02382"></a>02382     <a class="code" href="classdb_1_1upd.html" title="hilft beim anlegen von UPDATE-SQL AusdrÃ¼cken.">upd</a>&amp; <a class="code" href="classdb_1_1upd.html#ae1b592682cf66f339d863a5e0f05ee42" title="where">where</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">expr::base</a>&amp; e)
<a name="l02383"></a>02383     {
<a name="l02384"></a>02384       _where = expr::and_(expr::raw(_where), e).str();
<a name="l02385"></a>02385       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02386"></a>02386     }
<a name="l02387"></a>02387 
<a name="l02397"></a>02397     <a class="code" href="classdb_1_1upd.html" title="hilft beim anlegen von UPDATE-SQL AusdrÃ¼cken.">upd</a> &amp; <a class="code" href="classdb_1_1upd.html#a98ae07ff13cc7fc7e14808008d8c66af" title="operator%">operator%</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">expr::base</a>&amp; e)
<a name="l02398"></a>02398     { <span class="keywordflow">return</span> <a class="code" href="classdb_1_1upd.html#ae1b592682cf66f339d863a5e0f05ee42" title="where">where</a>(e); }
<a name="l02399"></a>02399 
<a name="l02409"></a>02409     <a class="code" href="classdb_1_1upd.html" title="hilft beim anlegen von UPDATE-SQL AusdrÃ¼cken.">upd</a> &amp; <a class="code" href="classdb_1_1upd.html#a98ae07ff13cc7fc7e14808008d8c66af" title="operator%">operator%</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a>&amp; f)
<a name="l02410"></a>02410     { 
<a name="l02411"></a>02411       <span class="keywordflow">if</span> (f.<a class="code" href="classdb_1_1field.html#abd933ffca0d086a69e0024bc72da5229" title="values">values</a>().size()==1)
<a name="l02412"></a>02412         <span class="keywordflow">return</span> <span class="keyword">set</span>(f, f.<a class="code" href="classdb_1_1field.html#abd933ffca0d086a69e0024bc72da5229" title="values">values</a>().begin()-&gt;second);
<a name="l02413"></a>02413       <span class="keywordflow">else</span>
<a name="l02414"></a>02414         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02415"></a>02415     }
<a name="l02416"></a>02416 
<a name="l02427"></a>02427     <a class="code" href="classdb_1_1upd.html" title="hilft beim anlegen von UPDATE-SQL AusdrÃ¼cken.">upd</a>&amp; <span class="keyword">set</span>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a>&amp; f, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; val)
<a name="l02428"></a>02428     {
<a name="l02429"></a>02429       fields.push_back(f.name());
<a name="l02430"></a>02430       <span class="keywordflow">if</span> (f.type()==e_string||f.type()==e_char||
<a name="l02431"></a>02431           f.type()==e_blob||f.type()==e_date_time)
<a name="l02432"></a>02432         values.push_back(detail::escape_sql(val));
<a name="l02433"></a>02433       <span class="keywordflow">else</span>
<a name="l02434"></a>02434         values.push_back(val);
<a name="l02435"></a>02435       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02436"></a>02436     }
<a name="l02437"></a>02437 
<a name="l02448"></a>02448     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l02449"></a>02449     <a class="code" href="classdb_1_1upd.html" title="hilft beim anlegen von UPDATE-SQL AusdrÃ¼cken.">upd</a>&amp; <span class="keyword">set</span>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a>&amp; f, <span class="keyword">const</span> T&amp; val)
<a name="l02450"></a>02450     { <span class="keywordflow">return</span> <span class="keyword">set</span>(f, detail::to_string(val)); }
<a name="l02451"></a>02451 
<a name="l02460"></a>02460     <a class="code" href="classdb_1_1upd.html#afb0ac8864bca50621ef75e94264a216a" title="operator string">operator string</a>()<span class="keyword"> const</span>
<a name="l02461"></a>02461 <span class="keyword">    </span>{ <span class="keywordflow">return</span> <a class="code" href="classdb_1_1upd.html#ab3bf59ecf95b65fa25439e1e8d6fbaf5" title="str">str</a>(); }
<a name="l02462"></a>02462 
<a name="l02471"></a>02471     <span class="keywordtype">string</span> <a class="code" href="classdb_1_1upd.html#ab3bf59ecf95b65fa25439e1e8d6fbaf5" title="str">str</a>()<span class="keyword"> const </span>
<a name="l02472"></a>02472 <span class="keyword">    </span>{
<a name="l02473"></a>02473       <span class="keywordtype">string</span> q = DB_TEXT(<span class="stringliteral">&quot;UPDATE &quot;</span>) + table + DB_TEXT(<span class="stringliteral">&quot; SET &quot;</span>);
<a name="l02474"></a>02474       split sets;
<a name="l02475"></a>02475       <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fields.size(); i++)
<a name="l02476"></a>02476         sets.push_back(fields[i] + DB_TEXT(<span class="stringliteral">&quot;=&quot;</span>) + values[i]);
<a name="l02477"></a>02477       q += sets.join(DB_TEXT(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l02478"></a>02478       <span class="keywordflow">if</span> (_where.length())
<a name="l02479"></a>02479         q += DB_TEXT(<span class="stringliteral">&quot; WHERE &quot;</span>) + _where;
<a name="l02480"></a>02480       <span class="keywordflow">return</span> q;
<a name="l02481"></a>02481     }
<a name="l02482"></a>02482   };
<a name="l02483"></a><a class="code" href="classdb_1_1base.html">02483</a> 
<a name="l02485"></a>02485   <span class="keyword">class </span><a class="code" href="classdb_1_1base.html" title="datenbank interface">base</a>
<a name="l02486"></a>02486   {
<a name="l02487"></a>02487     sqlite3* _db;
<a name="l02488"></a>02488 
<a name="l02489"></a>02489     <span class="keyword">class </span>progress_handler
<a name="l02490"></a>02490     {
<a name="l02500"></a>02500       <span class="keyword">static</span> <span class="keywordtype">int</span> xProgressCallback(<span class="keywordtype">void</span>* db_)
<a name="l02501"></a>02501       {
<a name="l02502"></a>02502         <span class="keywordflow">if</span> (!db_)
<a name="l02503"></a>02503           <span class="keywordflow">return</span> 1;
<a name="l02504"></a>02504         <a class="code" href="classdb_1_1base.html" title="datenbank interface">base</a>* base_(reinterpret_cast&lt;base*&gt; (db_));
<a name="l02505"></a>02505 
<a name="l02506"></a>02506         <span class="keywordflow">if</span> (!base_)
<a name="l02507"></a>02507           <span class="keywordflow">return</span> 1;
<a name="l02508"></a>02508 
<a name="l02509"></a>02509         <span class="comment">//if (!base_-&gt;Sig_Progress().connected())</span>
<a name="l02510"></a>02510         <span class="comment">//  return 1;</span>
<a name="l02511"></a>02511 
<a name="l02512"></a>02512         <span class="comment">//if (base_-&gt;Sig_Progress()(0,0))</span>
<a name="l02513"></a>02513         <span class="comment">//  return 0;</span>
<a name="l02514"></a>02514         <span class="comment">//else</span>
<a name="l02515"></a>02515 
<a name="l02516"></a>02516         <span class="keywordflow">return</span> 0;
<a name="l02517"></a>02517       } 
<a name="l02518"></a>02518 
<a name="l02519"></a>02519       sqlite3* _db;
<a name="l02520"></a>02520     <span class="keyword">public</span>:
<a name="l02521"></a>02521       progress_handler(sqlite3* db_, <a class="code" href="classdb_1_1base.html" title="datenbank interface">base</a>* base_) : _db(db_)
<a name="l02522"></a>02522       {
<a name="l02523"></a>02523         sqlite3_progress_handler(_db, 4, 
<a name="l02524"></a>02524           progress_handler::xProgressCallback, base_);
<a name="l02525"></a>02525       }
<a name="l02526"></a>02526         ~progress_handler()
<a name="l02527"></a>02527       {
<a name="l02528"></a>02528         sqlite3_progress_handler(_db, 0, 0, 0); 
<a name="l02529"></a>02529       }
<a name="l02530"></a>02530     };
<a name="l02531"></a>02531     
<a name="l02532"></a>02532     <span class="keyword">typedef</span> std::map&lt;string, query&gt; type_last_queries; 
<a name="l02533"></a>02533     type_last_queries _last_queries; 
<a name="l02534"></a>02534 
<a name="l02535"></a>02535   <span class="keyword">public</span>:
<a name="l02544"></a>02544     <a class="code" href="classdb_1_1base.html#aac00f71bde85a46b5e68de796231603f" title="base">base</a>() : _db(0)
<a name="l02545"></a>02545     {}
<a name="l02546"></a>02546 
<a name="l02555"></a>02555     <a class="code" href="classdb_1_1base.html#a288d06d068941c97739cf56879fdf2a2" title="~base">~base</a>()
<a name="l02556"></a>02556     {
<a name="l02557"></a>02557       <span class="keywordflow">if</span> (_db) 
<a name="l02558"></a>02558         sqlite3_close(_db);
<a name="l02559"></a>02559     }
<a name="l02560"></a>02560 
<a name="l02561"></a>02561     <span class="keyword">enum</span> feature
<a name="l02562"></a>02562     {
<a name="l02563"></a>02563       e_transact,
<a name="l02564"></a>02564       e_blob
<a name="l02565"></a>02565     };
<a name="l02566"></a>02566 
<a name="l02576"></a>02576     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classdb_1_1base.html#a66d992a19efa01b7d6d93a86fa31209a" title="throw_error">throw_error</a>(<span class="keywordtype">int</span> status) 
<a name="l02577"></a>02577     {
<a name="l02578"></a>02578       <span class="keywordtype">string</span> err(boost::str(
<a name="l02579"></a>02579         format(DB_TEXT(<span class="stringliteral">&quot;%d=status code : %s&quot;</span>)) % 
<a name="l02580"></a>02580           status % sqlite3_errmsg(_db)));
<a name="l02581"></a>02581       <span class="keywordflow">switch</span>(status) 
<a name="l02582"></a>02582       {
<a name="l02583"></a>02583       <span class="keywordflow">case</span> SQLITE_ERROR: <span class="keywordflow">throw</span> exception::sql_error(err);
<a name="l02584"></a>02584       <span class="keywordflow">case</span> SQLITE_INTERNAL: <span class="keywordflow">throw</span> exception::internal_error(err);
<a name="l02585"></a>02585       <span class="keywordflow">case</span> SQLITE_NOMEM: <span class="keywordflow">throw</span> exception::memory_error(err);
<a name="l02586"></a>02586       <span class="keywordflow">case</span> SQLITE_FULL: <span class="keywordflow">throw</span> exception::insertion_error(err);
<a name="l02587"></a>02587       <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> exception::unknown_error(DB_TEXT(<span class="stringliteral">&quot;compile failed: &quot;</span>) + err);
<a name="l02588"></a>02588       }
<a name="l02589"></a>02589     } 
<a name="l02590"></a>02590 
<a name="l02600"></a>02600     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1base.html#a986fcd43b00da854672ccd57309ae6cb" title="open the specified db">connect</a>(<span class="keyword">const</span> std::string&amp; file)
<a name="l02601"></a>02601     {
<a name="l02602"></a>02602       <span class="keywordflow">if</span> (_db) 
<a name="l02603"></a>02603         sqlite3_close(_db);
<a name="l02604"></a>02604       <span class="keywordtype">int</span> rc = sqlite3_open(file.c_str(), &amp;_db); 
<a name="l02605"></a>02605       <span class="keywordflow">if</span> (rc != SQLITE_OK)
<a name="l02606"></a>02606         <a class="code" href="classdb_1_1base.html#a66d992a19efa01b7d6d93a86fa31209a" title="throw_error">throw_error</a>(rc);
<a name="l02607"></a>02607       rc = sqlite3_errcode(_db);
<a name="l02608"></a>02608       <span class="keywordflow">if</span> (rc != SQLITE_OK)
<a name="l02609"></a>02609         <a class="code" href="classdb_1_1base.html#a66d992a19efa01b7d6d93a86fa31209a" title="throw_error">throw_error</a>(rc);
<a name="l02610"></a>02610     }
<a name="l02611"></a>02611 
<a name="l02620"></a>02620     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1base.html#acbdda74044dbbffba7e3dbaf939e5624" title="begins SQL transaction">begin</a>() 
<a name="l02621"></a>02621     {
<a name="l02622"></a>02622       <span class="keywordtype">int</span> rc(sqlite3_exec(_db, <span class="stringliteral">&quot;BEGIN;&quot;</span>, 0, 0, 0)); 
<a name="l02623"></a>02623       <span class="keywordflow">if</span> (rc != SQLITE_OK)
<a name="l02624"></a>02624         <a class="code" href="classdb_1_1base.html#a66d992a19efa01b7d6d93a86fa31209a" title="throw_error">throw_error</a>(rc);
<a name="l02625"></a>02625     }
<a name="l02626"></a>02626 
<a name="l02635"></a>02635     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1base.html#a81585ba05fbcf548731fbe61853b6308" title="commits SQL transaction">commit</a>() 
<a name="l02636"></a>02636     {
<a name="l02637"></a>02637       <span class="keywordtype">int</span> rc(sqlite3_exec(_db, <span class="stringliteral">&quot;COMMIT;&quot;</span>, 0, 0, 0)); 
<a name="l02638"></a>02638       <span class="keywordflow">if</span> (rc != SQLITE_OK)
<a name="l02639"></a>02639         <a class="code" href="classdb_1_1base.html#a66d992a19efa01b7d6d93a86fa31209a" title="throw_error">throw_error</a>(rc);
<a name="l02640"></a>02640     }
<a name="l02641"></a>02641 
<a name="l02650"></a>02650     <span class="keywordtype">void</span> <a class="code" href="classdb_1_1base.html#ae170528df76ab2cc6a4cb47fdfb6d0bd" title="cancels active SQL transaction">rollback</a>() 
<a name="l02651"></a>02651     {
<a name="l02652"></a>02652       <span class="keywordtype">int</span> rc(sqlite3_exec(_db, <span class="stringliteral">&quot;ROLLBACK;&quot;</span>, 0, 0, 0)); 
<a name="l02653"></a>02653       <span class="keywordflow">if</span> (rc != SQLITE_OK)
<a name="l02654"></a>02654         <a class="code" href="classdb_1_1base.html#a66d992a19efa01b7d6d93a86fa31209a" title="throw_error">throw_error</a>(rc);
<a name="l02655"></a>02655     }
<a name="l02656"></a>02656 
<a name="l02666"></a>02666     <span class="keyword">inline</span> <a class="code" href="classdb_1_1query.html" title="cursor interface">query</a>&amp; <a class="code" href="classdb_1_1base.html#aeb357f98d617503b9d6658b0a7cd24f6" title="execute SQL statement">execute</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; cmd);
<a name="l02667"></a>02667 
<a name="l02677"></a>02677     <span class="keyword">inline</span> query_ptr <a class="code" href="classdb_1_1base.html#a7f8d4ffcb3c985b7497de53711da06df" title="execute">execute_ptr</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; cmd);
<a name="l02678"></a>02678 
<a name="l02687"></a>02687     sqlite3* <a class="code" href="classdb_1_1base.html#a40a2e6f658f12e81979f477034cff2ad" title="get_db_ptr">get_db_ptr</a>() {<span class="keywordflow">return</span> _db;}
<a name="l02688"></a>02688 
<a name="l02689"></a>02689 <span class="comment">//#ifndef BOOST_NO_STD_LOCALE</span>
<a name="l02690"></a>02690 <span class="comment">//    typedef boost::signal2&lt;bool, unsigned, unsigned&gt; type_signal_progress; </span>
<a name="l02691"></a>02691 <span class="comment">//</span>
<a name="l02692"></a>02692 <span class="comment">//    /// @brief     Sig_Progress</span>
<a name="l02693"></a>02693 <span class="comment">//    ///</span>
<a name="l02694"></a>02694 <span class="comment">//    /// &lt;BR&gt;qualifier</span>
<a name="l02695"></a>02695 <span class="comment">//    /// &lt;BR&gt;access    public  </span>
<a name="l02696"></a>02696 <span class="comment">//    /// @return    type_signal_progress&amp;</span>
<a name="l02697"></a>02697 <span class="comment">//    ///</span>
<a name="l02698"></a>02698 <span class="comment">//    /// @date      20:2:2009   14:16</span>
<a name="l02699"></a>02699 <span class="comment">//    ///</span>
<a name="l02700"></a>02700 <span class="comment">//    type_signal_progress&amp; Sig_Progress() { return sig_progress; }</span>
<a name="l02701"></a>02701 <span class="comment">//</span>
<a name="l02702"></a>02702 <span class="comment">//#endif // BOOST_NO_STD_LOCALE</span>
<a name="l02703"></a>02703   <span class="keyword">protected</span>:
<a name="l02704"></a>02704 <span class="comment">//#ifndef BOOST_NO_STD_LOCALE</span>
<a name="l02705"></a>02705 <span class="comment">//    type_signal_progress sig_progress;</span>
<a name="l02706"></a>02706 <span class="comment">//#endif // BOOST_NO_STD_LOCALE</span>
<a name="l02707"></a>02707   };
<a name="l02708"></a>02708   <span class="keyword">typedef</span> boost::shared_ptr&lt;base&gt; base_ptr;
<a name="l02709"></a>02709 
<a name="l02710"></a>02710 <span class="preprocessor">#ifdef _MFC_VER</span>
<a name="l02711"></a>02711 <span class="preprocessor"></span>
<a name="l02712"></a>02712   <span class="keyword">namespace </span>serialize
<a name="l02713"></a>02713   {
<a name="l02714"></a>02714     <span class="keyword">class </span><a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a> : <span class="keyword">public</span> CObject
<a name="l02715"></a>02715     {
<a name="l02716"></a>02716       <span class="keywordtype">string</span> _name;
<a name="l02717"></a>02717       <span class="keywordtype">int</span>    _type;
<a name="l02718"></a>02718 
<a name="l02719"></a>02719     <span class="keyword">public</span>:
<a name="l02727"></a>02727       <a class="code" href="classdb_1_1field.html" title="fieldtype interface">field</a>() : CObject(), _type(db::e_null) {}
<a name="l02728"></a>02728       
<a name="l02739"></a>02739       field(param_types type_, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name_) : CObject(),
<a name="l02740"></a>02740         _type(type_), _name(name_) 
<a name="l02741"></a>02741       {}
<a name="l02742"></a>02742 
<a name="l02752"></a>02752       field(<span class="keyword">const</span> field&amp; f) : CObject(), _type(f._type), _name(f._name) 
<a name="l02753"></a>02753       {}
<a name="l02754"></a>02754 
<a name="l02764"></a>02764       field&amp; operator=(<span class="keyword">const</span> field&amp; f)
<a name="l02765"></a>02765       {
<a name="l02766"></a>02766         _type = f._type;
<a name="l02767"></a>02767         _name = f._name;
<a name="l02768"></a>02768         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02769"></a>02769       }
<a name="l02770"></a>02770 
<a name="l02771"></a>02771       <span class="keyword">const</span> db::string&amp; name()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _name; }
<a name="l02772"></a>02772       <span class="keywordtype">void</span> name(<span class="keyword">const</span> db::string&amp; val) { _name = val; }
<a name="l02773"></a>02773 
<a name="l02774"></a>02774       param_types Type()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>param_types<span class="keyword">&gt;</span>(_type); }
<a name="l02775"></a>02775       <span class="keywordtype">void</span> Type(param_types val) { _type = val; }
<a name="l02776"></a>02776 
<a name="l02786"></a>02786       <span class="keyword">virtual</span> <span class="keywordtype">void</span> Serialize(CArchive&amp; ar)
<a name="l02787"></a>02787       {
<a name="l02788"></a>02788         CObject::Serialize(ar);
<a name="l02789"></a>02789 
<a name="l02790"></a>02790         <span class="keywordflow">if</span>( ar.IsStoring() )
<a name="l02791"></a>02791         {
<a name="l02792"></a>02792           ar.WriteCount(_type);
<a name="l02793"></a>02793           ar &lt;&lt; CString(_name.c_str());
<a name="l02794"></a>02794 <span class="preprocessor">#ifdef _BOOST_TEST</span>
<a name="l02795"></a>02795 <span class="preprocessor"></span><span class="preprocessor">#ifdef _DEBUG</span>
<a name="l02796"></a>02796 <span class="preprocessor"></span>          OutputDebugStringW(db::detail::to_string(_type).c_str());
<a name="l02797"></a>02797           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02798"></a>02798           OutputDebugStringW(_name.c_str());
<a name="l02799"></a>02799           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02800"></a>02800 <span class="preprocessor">#endif // _DEBUG</span>
<a name="l02801"></a>02801 <span class="preprocessor"></span><span class="preprocessor">#endif        </span>
<a name="l02802"></a>02802 <span class="preprocessor"></span>        }
<a name="l02803"></a>02803         <span class="keywordflow">else</span>
<a name="l02804"></a>02804         {
<a name="l02805"></a>02805           _type = ar.ReadCount();
<a name="l02806"></a>02806           CString tmp;
<a name="l02807"></a>02807           ar &gt;&gt; tmp;
<a name="l02808"></a>02808           _name = tmp;
<a name="l02809"></a>02809 
<a name="l02810"></a>02810 <span class="preprocessor">#ifdef _BOOST_TEST</span>
<a name="l02811"></a>02811 <span class="preprocessor"></span><span class="preprocessor">#ifdef _DEBUG</span>
<a name="l02812"></a>02812 <span class="preprocessor"></span>          OutputDebugStringW(db::detail::to_string(_type).c_str());
<a name="l02813"></a>02813           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02814"></a>02814           OutputDebugStringW(_name.c_str());
<a name="l02815"></a>02815           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02816"></a>02816 <span class="preprocessor">#endif // _DEBUG</span>
<a name="l02817"></a>02817 <span class="preprocessor"></span><span class="preprocessor">#endif        </span>
<a name="l02818"></a>02818 <span class="preprocessor"></span>        }
<a name="l02819"></a>02819       }
<a name="l02820"></a>02820 
<a name="l02821"></a>02821       DECLARE_SERIAL(field);
<a name="l02822"></a>02822     };
<a name="l02823"></a>02823 
<a name="l02824"></a>02824     <span class="keyword">typedef</span> std::vector&lt;db::serialize::field&gt; t_ser_field;
<a name="l02825"></a>02825 
<a name="l02826"></a>02826     <span class="keyword">class </span>row : <span class="keyword">public</span> CObject
<a name="l02827"></a>02827     {
<a name="l02828"></a>02828       string_vec _data;
<a name="l02829"></a>02829       
<a name="l02830"></a>02830     <span class="keyword">public</span>:
<a name="l02839"></a>02839       row() : CObject() 
<a name="l02840"></a>02840       {}
<a name="l02841"></a>02841 
<a name="l02851"></a>02851       row(<span class="keyword">const</span> row&amp; r) : CObject(), _data(r._data)
<a name="l02852"></a>02852       {}
<a name="l02853"></a>02853 
<a name="l02862"></a>02862       ~row() {}
<a name="l02863"></a>02863 
<a name="l02873"></a>02873       row&amp; operator=(<span class="keyword">const</span> row&amp; r)
<a name="l02874"></a>02874       {
<a name="l02875"></a>02875         _data = r._data;
<a name="l02876"></a>02876         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02877"></a>02877       }
<a name="l02878"></a>02878 
<a name="l02879"></a>02879       db::string_vec&amp; Data() { <span class="keywordflow">return</span> _data; }
<a name="l02880"></a>02880       <span class="keyword">const</span> db::string_vec&amp; Data()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _data; }
<a name="l02881"></a>02881 
<a name="l02891"></a>02891       <span class="keyword">virtual</span> <span class="keywordtype">void</span> Serialize(CArchive&amp; ar)
<a name="l02892"></a>02892       {
<a name="l02893"></a>02893         CObject::Serialize(ar);
<a name="l02894"></a>02894 
<a name="l02895"></a>02895         <span class="keywordflow">if</span>( ar.IsStoring() )
<a name="l02896"></a>02896         {
<a name="l02897"></a>02897           ar.WriteCount(_data.size());
<a name="l02898"></a>02898 <span class="preprocessor">#ifdef _BOOST_TEST</span>
<a name="l02899"></a>02899 <span class="preprocessor"></span><span class="preprocessor">#ifdef _DEBUG</span>
<a name="l02900"></a>02900 <span class="preprocessor"></span>          OutputDebugStringW(db::detail::to_string(_data.size()).c_str());
<a name="l02901"></a>02901           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02902"></a>02902 <span class="preprocessor">#endif</span>
<a name="l02903"></a>02903 <span class="preprocessor"></span><span class="preprocessor">#endif          </span>
<a name="l02904"></a>02904 <span class="preprocessor"></span>          <span class="keywordflow">for</span> (string_vec::iterator itb(_data.begin()), 
<a name="l02905"></a>02905             ite(_data.end()); itb!=ite; ++itb)
<a name="l02906"></a>02906           {
<a name="l02907"></a>02907             ar &lt;&lt; CString(itb-&gt;c_str());
<a name="l02908"></a>02908 <span class="preprocessor">#ifdef _BOOST_TEST</span>
<a name="l02909"></a>02909 <span class="preprocessor"></span><span class="preprocessor">#ifdef _DEBUG</span>
<a name="l02910"></a>02910 <span class="preprocessor"></span>            OutputDebugStringW(itb-&gt;c_str());
<a name="l02911"></a>02911             OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02912"></a>02912 <span class="preprocessor">#endif // _DEBUG</span>
<a name="l02913"></a>02913 <span class="preprocessor"></span><span class="preprocessor">#endif          </span>
<a name="l02914"></a>02914 <span class="preprocessor"></span>          }
<a name="l02915"></a>02915         }
<a name="l02916"></a>02916         <span class="keywordflow">else</span>
<a name="l02917"></a>02917         {
<a name="l02918"></a>02918           DWORD_PTR cnts(ar.ReadCount());
<a name="l02919"></a>02919 <span class="preprocessor">#ifdef _BOOST_TEST</span>
<a name="l02920"></a>02920 <span class="preprocessor"></span><span class="preprocessor">#ifdef _DEBUG</span>
<a name="l02921"></a>02921 <span class="preprocessor"></span>          OutputDebugStringW(db::detail::to_string(cnts).c_str());
<a name="l02922"></a>02922           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02923"></a>02923 <span class="preprocessor">#endif</span>
<a name="l02924"></a>02924 <span class="preprocessor"></span><span class="preprocessor">#endif          </span>
<a name="l02925"></a>02925 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (cnts&gt;0)
<a name="l02926"></a>02926           {
<a name="l02927"></a>02927             _data.resize(cnts);
<a name="l02928"></a>02928             
<a name="l02929"></a>02929             <span class="keywordflow">for</span> (DWORD_PTR cnt(0); cnt&lt;cnts; ++cnt)
<a name="l02930"></a>02930             {
<a name="l02931"></a>02931               CString tmp;
<a name="l02932"></a>02932               ar &gt;&gt; tmp;
<a name="l02933"></a>02933               _data[cnt] = tmp;
<a name="l02934"></a>02934 <span class="preprocessor">#ifdef _BOOST_TEST</span>
<a name="l02935"></a>02935 <span class="preprocessor"></span><span class="preprocessor">#ifdef _DEBUG</span>
<a name="l02936"></a>02936 <span class="preprocessor"></span>              OutputDebugStringW(tmp);
<a name="l02937"></a>02937               OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02938"></a>02938 <span class="preprocessor">#endif // _DEBUG</span>
<a name="l02939"></a>02939 <span class="preprocessor"></span><span class="preprocessor">#endif            </span>
<a name="l02940"></a>02940 <span class="preprocessor"></span>            }
<a name="l02941"></a>02941           }
<a name="l02942"></a>02942         }
<a name="l02943"></a>02943       }
<a name="l02944"></a>02944       
<a name="l02945"></a>02945       DECLARE_SERIAL(row);
<a name="l02946"></a>02946     };
<a name="l02947"></a>02947 
<a name="l02948"></a>02948     <span class="keyword">typedef</span> std::vector&lt;db::serialize::row&gt; t_ser_row;
<a name="l02949"></a>02949 
<a name="l02950"></a>02950 
<a name="l02951"></a>02951     <span class="keyword">class </span>table : <span class="keyword">public</span> CObject
<a name="l02952"></a>02952     {
<a name="l02953"></a>02953       <span class="keywordtype">string</span> _name;
<a name="l02954"></a>02954       t_ser_field  _fields;
<a name="l02955"></a>02955       t_ser_row _rows;
<a name="l02956"></a>02956 
<a name="l02957"></a>02957     <span class="keyword">public</span>:
<a name="l02966"></a>02966       table() : CObject() {}
<a name="l02967"></a>02967 
<a name="l02977"></a>02977       table(<span class="keyword">const</span> table&amp; t) : CObject(), _name(t._name), _fields(t._fields),
<a name="l02978"></a>02978         _rows(t._rows)
<a name="l02979"></a>02979       {}
<a name="l02980"></a>02980 
<a name="l02990"></a>02990       table(<span class="keyword">const</span> db::string&amp; name_) : CObject(), _name(name_) 
<a name="l02991"></a>02991       {}
<a name="l02992"></a>02992 
<a name="l03002"></a>03002       table&amp; operator=(<span class="keyword">const</span> table&amp; t)
<a name="l03003"></a>03003       {
<a name="l03004"></a>03004         _name   = t._name; 
<a name="l03005"></a>03005         _fields = t._fields;
<a name="l03006"></a>03006         _rows   = t._rows;
<a name="l03007"></a>03007 
<a name="l03008"></a>03008         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l03009"></a>03009       }
<a name="l03010"></a>03010 
<a name="l03011"></a>03011       <span class="keyword">const</span> db::string&amp; name()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _name; }
<a name="l03012"></a>03012       <span class="keywordtype">void</span> name(<span class="keyword">const</span> db::string&amp; val) { _name = val; }
<a name="l03013"></a>03013 
<a name="l03014"></a>03014       db::serialize::t_ser_field&amp; fields() { <span class="keywordflow">return</span> _fields; }
<a name="l03015"></a>03015       <span class="keyword">const</span> db::serialize::t_ser_field&amp; fields()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _fields; }
<a name="l03016"></a>03016 
<a name="l03017"></a>03017       db::serialize::t_ser_row&amp; rows() { <span class="keywordflow">return</span> _rows; }
<a name="l03018"></a>03018       <span class="keyword">const</span> db::serialize::t_ser_row&amp; rows()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _rows; }
<a name="l03019"></a>03019 
<a name="l03029"></a>03029       <span class="keyword">virtual</span> <span class="keywordtype">void</span> Serialize(CArchive&amp; ar)
<a name="l03030"></a>03030       {
<a name="l03031"></a>03031         CObject::Serialize(ar);
<a name="l03032"></a>03032 
<a name="l03033"></a>03033         <span class="keywordflow">if</span>( ar.IsStoring() )
<a name="l03034"></a>03034         {
<a name="l03035"></a>03035           ar.WriteCount(_fields.size());
<a name="l03036"></a>03036           ar.WriteCount(_rows.size());
<a name="l03037"></a>03037           ar &lt;&lt; CString(_name.c_str());
<a name="l03038"></a>03038 
<a name="l03039"></a>03039 <span class="preprocessor">#ifdef _BOOST_TEST</span>
<a name="l03040"></a>03040 <span class="preprocessor"></span><span class="preprocessor">#ifdef _DEBUG</span>
<a name="l03041"></a>03041 <span class="preprocessor"></span>          OutputDebugStringW(db::detail::to_string(_fields.size()).c_str());
<a name="l03042"></a>03042           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03043"></a>03043           OutputDebugStringW(db::detail::to_string(_rows.size()).c_str());
<a name="l03044"></a>03044           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03045"></a>03045           OutputDebugStringW(_name.c_str());
<a name="l03046"></a>03046           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03047"></a>03047 <span class="preprocessor">#endif</span>
<a name="l03048"></a>03048 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l03049"></a>03049 <span class="preprocessor"></span>          <span class="keywordflow">for</span> (t_ser_field::iterator itb(_fields.begin()), 
<a name="l03050"></a>03050             ite(_fields.end()); itb!=ite; ++itb)
<a name="l03051"></a>03051             itb-&gt;Serialize(ar);
<a name="l03052"></a>03052 
<a name="l03053"></a>03053           <span class="keywordflow">for</span> (t_ser_row::iterator itb(_rows.begin()), 
<a name="l03054"></a>03054             ite(_rows.end()); itb!=ite; ++itb)
<a name="l03055"></a>03055             itb-&gt;Serialize(ar);
<a name="l03056"></a>03056         }
<a name="l03057"></a>03057         <span class="keywordflow">else</span>
<a name="l03058"></a>03058         {
<a name="l03059"></a>03059           DWORD_PTR cnt_fields(ar.ReadCount());
<a name="l03060"></a>03060           DWORD_PTR cnt_rows(ar.ReadCount());
<a name="l03061"></a>03061           
<a name="l03062"></a>03062           CString name; ar &gt;&gt; name;
<a name="l03063"></a>03063           _name = name;
<a name="l03064"></a>03064 
<a name="l03065"></a>03065 <span class="preprocessor">#ifdef _BOOST_TEST</span>
<a name="l03066"></a>03066 <span class="preprocessor"></span><span class="preprocessor">#ifdef _DEBUG</span>
<a name="l03067"></a>03067 <span class="preprocessor"></span>          OutputDebugStringW(db::detail::to_string(cnt_fields).c_str());
<a name="l03068"></a>03068           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03069"></a>03069           OutputDebugStringW(db::detail::to_string(cnt_rows).c_str());
<a name="l03070"></a>03070           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03071"></a>03071           OutputDebugStringW(_name.c_str());
<a name="l03072"></a>03072           OutputDebugStringW(L<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03073"></a>03073 <span class="preprocessor">#endif</span>
<a name="l03074"></a>03074 <span class="preprocessor"></span><span class="preprocessor">#endif          </span>
<a name="l03075"></a>03075 <span class="preprocessor"></span>          _fields.reserve(cnt_fields);
<a name="l03076"></a>03076           <span class="keywordflow">for</span> (t_ser_field::size_type cnt(0); cnt&lt;cnt_fields; ++cnt)
<a name="l03077"></a>03077           {
<a name="l03078"></a>03078             _fields.push_back(db::serialize::field());
<a name="l03079"></a>03079             _fields.back().Serialize(ar);
<a name="l03080"></a>03080           }
<a name="l03081"></a>03081 
<a name="l03082"></a>03082           _rows.reserve(cnt_rows);
<a name="l03083"></a>03083           <span class="keywordflow">for</span> (t_ser_row::size_type cnt(0); cnt&lt;cnt_rows; ++cnt)
<a name="l03084"></a>03084           {
<a name="l03085"></a>03085             _rows.push_back(db::serialize::row());
<a name="l03086"></a>03086             _rows.back().Serialize(ar);
<a name="l03087"></a>03087           }
<a name="l03088"></a>03088         }
<a name="l03089"></a>03089       }
<a name="l03090"></a>03090 
<a name="l03091"></a>03091       <span class="keyword">typedef</span> std::vector&lt;db::serialize::table&gt; t_ser_table;
<a name="l03092"></a>03092 
<a name="l03093"></a>03093       DECLARE_SERIAL(table);
<a name="l03094"></a>03094     };
<a name="l03095"></a>03095 
<a name="l03096"></a>03096     <span class="keyword">typedef</span> std::vector&lt;table &gt; t_ser_table;
<a name="l03097"></a>03097   }
<a name="l03098"></a>03098 
<a name="l03099"></a>03099 <span class="preprocessor">#endif // _MFC_VER</span>
<a name="l03100"></a>03100 <span class="preprocessor"></span>
<a name="l03101"></a>03101 } <span class="comment">// namespace db</span>
<a name="l03102"></a>03102 
<a name="l03104"></a><a class="code" href="db_8hpp.html#aa40a6c3f62795514880337af0bae10a8">03104</a> <span class="keyword">inline</span> db::expr::and_ <a class="code" href="db_8hpp.html#aa40a6c3f62795514880337af0bae10a8" title="overload from the global &amp;amp;&amp;amp; operator">operator&amp;&amp;</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">db::expr::base</a>&amp; o1, 
<a name="l03105"></a>03105                                 <span class="keyword">const</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">db::expr::base</a>&amp; o2)
<a name="l03106"></a>03106 { <span class="keywordflow">return</span> db::expr::and_(o1,o2); }
<a name="l03108"></a><a class="code" href="db_8hpp.html#a4132ffa7315064d70ed52e05bd4099fc">03108</a> <span class="keyword">inline</span> db::expr::or_ <a class="code" href="db_8hpp.html#a4132ffa7315064d70ed52e05bd4099fc" title="overload from the global || operator">operator||</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">db::expr::base</a>&amp; o1, 
<a name="l03109"></a>03109                                <span class="keyword">const</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">db::expr::base</a>&amp; o2)
<a name="l03110"></a>03110 { <span class="keywordflow">return</span> db::expr::or_(o1,o2); }
<a name="l03111"></a>03111 
<a name="l03122"></a>03122 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l03123"></a><a class="code" href="db_8hpp.html#acc0d1d1418ecfaa6231eea1b6d371c7c">03123</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1eq.html" title="==, is equal operator">db::expr::eq</a> <a class="code" href="db_8hpp.html#acc0d1d1418ecfaa6231eea1b6d371c7c" title="overload from the global == operator">operator==</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a>&amp; fld, <span class="keyword">const</span> T&amp; f2)
<a name="l03124"></a>03124 { <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1eq.html" title="==, is equal operator">db::expr::eq</a>(fld, f2); }
<a name="l03125"></a>03125 
<a name="l03136"></a>03136 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l03137"></a><a class="code" href="db_8hpp.html#ab9eb77305f07d00ab5bee6636d47dad8">03137</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1gt.html" title="&amp;gt; greater then operator">db::expr::gt</a> <a class="code" href="db_8hpp.html#ab9eb77305f07d00ab5bee6636d47dad8" title="overload from the global &amp;gt; operator">operator&gt;</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a>&amp; fld, <span class="keyword">const</span> T&amp; o2)
<a name="l03138"></a>03138 { <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1gt.html" title="&amp;gt; greater then operator">db::expr::gt</a>(fld, o2); }
<a name="l03139"></a>03139 
<a name="l03150"></a>03150 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l03151"></a><a class="code" href="db_8hpp.html#a9a7fbc39689990200a92f75d8df70674">03151</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1gt__eq.html" title="greater then or equal operator">db::expr::gt_eq</a> <a class="code" href="db_8hpp.html#a9a7fbc39689990200a92f75d8df70674" title="overload from the global &amp;gt;= operator">operator&gt;=</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a>&amp; fld, <span class="keyword">const</span> T&amp; o2)
<a name="l03152"></a>03152 { <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1gt__eq.html" title="greater then or equal operator">db::expr::gt_eq</a>(fld, o2); }
<a name="l03153"></a>03153 
<a name="l03164"></a>03164 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l03165"></a><a class="code" href="db_8hpp.html#a157959b0ef56721142f4cbff1b92f7d8">03165</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1lt.html" title="lower then operator">db::expr::lt</a> <a class="code" href="db_8hpp.html#a157959b0ef56721142f4cbff1b92f7d8" title="overload from the global &amp;lt; operator">operator&lt;</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a>&amp; fld, <span class="keyword">const</span> T&amp; o2)
<a name="l03166"></a>03166 { <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1lt.html" title="lower then operator">db::expr::lt</a>(fld, o2); }
<a name="l03167"></a>03167 
<a name="l03178"></a>03178 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l03179"></a><a class="code" href="db_8hpp.html#a446b19cb615447b982546e46a7f4c43d">03179</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1lt__eq.html" title="lower then or equal operator">db::expr::lt_eq</a> <a class="code" href="db_8hpp.html#a446b19cb615447b982546e46a7f4c43d" title="overload from the global &amp;lt;= operator">operator&lt;=</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a>&amp; fld, <span class="keyword">const</span> T&amp; o2)
<a name="l03180"></a>03180 { <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1lt__eq.html" title="lower then or equal operator">db::expr::lt_eq</a>(fld, o2); }
<a name="l03181"></a>03181 
<a name="l03192"></a>03192 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l03193"></a><a class="code" href="db_8hpp.html#acc9c963b23771df6433c602bf4b88712">03193</a> <span class="keyword">inline</span> db::expr::not_eq_ <a class="code" href="db_8hpp.html#acc9c963b23771df6433c602bf4b88712" title="overload from the global != operator">operator!=</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a>&amp; fld, <span class="keyword">const</span> T&amp; f2)
<a name="l03194"></a>03194 { <span class="keywordflow">return</span> db::expr::not_eq_(fld, f2); }
<a name="l03195"></a>03195 
<a name="l03205"></a><a class="code" href="db_8hpp.html#a34476037444344ea7f1f700032edb373">03205</a> <span class="keyword">inline</span> db::expr::not_ <a class="code" href="db_8hpp.html#a34476037444344ea7f1f700032edb373" title="overload from the global ! operator">operator!</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1expr_1_1base.html" title="expression base class">db::expr::base</a> &amp;exp)
<a name="l03206"></a>03206 { <span class="keywordflow">return</span> db::expr::not_(exp); }
<a name="l03207"></a>03207 
<a name="l03218"></a><a class="code" href="db_8hpp.html#aa7eacb1a5f11f5a39476a316e50ee727">03218</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1in.html" title="in Operator">db::expr::in</a> <a class="code" href="db_8hpp.html#aa7eacb1a5f11f5a39476a316e50ee727" title="overload from the global &amp;lt;&amp;lt; operator">operator&lt;&lt;</a>(
<a name="l03219"></a>03219       <span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a>&amp; fld
<a name="l03220"></a>03220     , <span class="keyword">const</span> db::char_type* f2)
<a name="l03221"></a>03221 { <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1in.html" title="in Operator">db::expr::in</a>(fld,f2); }
<a name="l03222"></a>03222 
<a name="l03233"></a><a class="code" href="db_8hpp.html#a8756bc62bee82a1616460ffa6adf1731">03233</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1in.html" title="in Operator">db::expr::in</a> <a class="code" href="db_8hpp.html#aa7eacb1a5f11f5a39476a316e50ee727" title="overload from the global &amp;lt;&amp;lt; operator">operator&lt;&lt;</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a>&amp; fld, <span class="keyword">const</span> db::string&amp; f2)
<a name="l03234"></a>03234 { <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1in.html" title="in Operator">db::expr::in</a>(fld,f2); }
<a name="l03235"></a>03235 
<a name="l03245"></a><a class="code" href="classdb_1_1field.html#a2916ac60c608a1a023b91df8fb1af67b">03245</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1in.html" title="in Operator">db::expr::in</a> <a class="code" href="classdb_1_1field.html#a2916ac60c608a1a023b91df8fb1af67b" title="syntactic sugar to expression-api, field.in(sel)">db::field::In</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; <span class="keyword">set</span>)<span class="keyword"> const</span>
<a name="l03246"></a>03246 <span class="keyword"></span>{ <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1in.html" title="in Operator">expr::in</a>(*<span class="keyword">this</span>, <span class="keyword">set</span>); }
<a name="l03247"></a>03247 
<a name="l03257"></a><a class="code" href="classdb_1_1field.html#ac075096caf21a1dd00a1b401eb8b666d">03257</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1in.html" title="in Operator">db::expr::in</a> <a class="code" href="classdb_1_1field.html#a2916ac60c608a1a023b91df8fb1af67b" title="syntactic sugar to expression-api, field.in(sel)">db::field::In</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a>&amp; <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">sel</a>)<span class="keyword"> const</span>
<a name="l03258"></a>03258 <span class="keyword"></span>{ <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1in.html" title="in Operator">expr::in</a>(*<span class="keyword">this</span>, sel); }
<a name="l03259"></a>03259 
<a name="l03269"></a><a class="code" href="classdb_1_1field.html#a045f9b5ad7b586e91e874d0358cee06f">03269</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1like.html" title="like operator">db::expr::like</a> <a class="code" href="classdb_1_1field.html#a045f9b5ad7b586e91e874d0358cee06f" title="syntactic sugar to expression-api, field.like(string)">db::field::Like</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s)
<a name="l03270"></a>03270 { <span class="keywordflow">return</span> <a class="code" href="classdb_1_1expr_1_1like.html" title="like operator">expr::like</a>(*<span class="keyword">this</span>, s); }
<a name="l03271"></a>03271 
<a name="l03272"></a><a class="code" href="classdb_1_1expr_1_1in.html#a75f317f08e5106a76d4ab522b70ec881">03272</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1expr_1_1in.html#a8ebc456dda9925e8275b4ebf0b2a5375" title="in">db::expr::in::in</a>(<span class="keyword">const</span> <a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a> &amp; fld, <span class="keyword">const</span> <a class="code" href="classdb_1_1sel.html" title="helper class, generates SELECT SQL statements">db::sel</a>&amp; s) : 
<a name="l03273"></a>03273   <a class="code" href="classdb_1_1expr_1_1oper.html" title="base class for operators in sql terms">oper</a>(fld, DB_TEXT(<span class="stringliteral">&quot;in&quot;</span>), DB_TEXT(<span class="stringliteral">&quot;(&quot;</span>) + s.str() + DB_TEXT(<span class="stringliteral">&quot;)&quot;</span>)) 
<a name="l03274"></a>03274 {
<a name="l03275"></a>03275 }
<a name="l03276"></a>03276 
<a name="l03277"></a><a class="code" href="classdb_1_1row.html#a38f3b6a5568643438119729633630921">03277</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classdb_1_1row.html#a38f3b6a5568643438119729633630921" title="fill">db::row::fill</a>(sqlite3_stmt* stm)
<a name="l03278"></a>03278 {
<a name="l03279"></a>03279   <span class="keywordflow">if</span> (!stm)
<a name="l03280"></a>03280     <span class="keywordflow">return</span>;
<a name="l03281"></a>03281   <span class="keywordflow">if</span> (!_query)
<a name="l03282"></a>03282     <span class="keywordflow">return</span>;
<a name="l03283"></a>03283 
<a name="l03284"></a>03284   _data.reserve(sqlite3_column_count(stm));
<a name="l03285"></a>03285   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i(0), sz(sqlite3_column_count(stm)); i &lt; sz; ++i)
<a name="l03286"></a>03286   {
<a name="l03287"></a>03287     _data.push_back(<a class="code" href="classdb_1_1param.html" title="dynamic parameter class*/">param</a>(i));
<a name="l03288"></a>03288     _data.back().set(stm);
<a name="l03289"></a>03289   } 
<a name="l03290"></a>03290 }
<a name="l03291"></a>03291 
<a name="l03292"></a><a class="code" href="classdb_1_1base.html#aeb357f98d617503b9d6658b0a7cd24f6">03292</a> <span class="keyword">inline</span> <a class="code" href="classdb_1_1query.html" title="cursor interface">db::query</a>&amp; <a class="code" href="classdb_1_1base.html#aeb357f98d617503b9d6658b0a7cd24f6" title="execute SQL statement">db::base::execute</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; cmd)
<a name="l03293"></a>03293 {
<a name="l03294"></a>03294   progress_handler progress(_db, <span class="keyword">this</span>);
<a name="l03295"></a>03295 
<a name="l03296"></a>03296   type_last_queries::iterator it(_last_queries.find(cmd));
<a name="l03297"></a>03297   <span class="keywordflow">if</span> (it==_last_queries.end())
<a name="l03298"></a>03298   {
<a name="l03299"></a>03299     _last_queries.insert(type_last_queries::value_type(cmd, <a class="code" href="classdb_1_1query.html" title="cursor interface">query</a>(*<span class="keyword">this</span>)));
<a name="l03300"></a>03300     it = _last_queries.find(cmd);
<a name="l03301"></a>03301   }
<a name="l03302"></a>03302 
<a name="l03303"></a>03303   it-&gt;second.execute(cmd);
<a name="l03304"></a>03304   <span class="keywordflow">return</span> it-&gt;second;
<a name="l03305"></a>03305 }
<a name="l03306"></a>03306 
<a name="l03307"></a><a class="code" href="classdb_1_1base.html#a7f8d4ffcb3c985b7497de53711da06df">03307</a> <span class="keyword">inline</span> db::query_ptr <a class="code" href="classdb_1_1base.html#a7f8d4ffcb3c985b7497de53711da06df" title="execute">db::base::execute_ptr</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; cmd)
<a name="l03308"></a>03308 {
<a name="l03309"></a>03309   progress_handler progress(_db, <span class="keyword">this</span>);
<a name="l03310"></a>03310   db::query_ptr ret(<span class="keyword">new</span> <a class="code" href="classdb_1_1query.html" title="cursor interface">query</a>(*<span class="keyword">this</span>));
<a name="l03311"></a>03311   <span class="keywordflow">if</span> (ret)
<a name="l03312"></a>03312     ret-&gt;execute(cmd);
<a name="l03313"></a>03313   <span class="keywordflow">return</span> ret;
<a name="l03314"></a>03314 }
<a name="l03315"></a>03315 
<a name="l03316"></a><a class="code" href="classdb_1_1query.html#abd3023e4cb57d7b2ec61d34ef32c7f1e">03316</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classdb_1_1query.html#abd3023e4cb57d7b2ec61d34ef32c7f1e">db::query::execute</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; cmd)
<a name="l03317"></a>03317 {
<a name="l03318"></a>03318   <span class="keywordflow">if</span> (_stm) { sqlite3_finalize(_stm); _stm = 0; }
<a name="l03319"></a>03319   sqlite3* _db(_base.<a class="code" href="classdb_1_1base.html#a40a2e6f658f12e81979f477034cff2ad" title="get_db_ptr">get_db_ptr</a>());
<a name="l03320"></a>03320 
<a name="l03321"></a>03321   _data.clear();
<a name="l03322"></a>03322 
<a name="l03323"></a>03323   <span class="keywordtype">int</span> rc;
<a name="l03324"></a>03324   <span class="keywordflow">while</span> (1) 
<a name="l03325"></a>03325   {
<a name="l03326"></a>03326 <span class="preprocessor">#ifdef _UNICODE</span>
<a name="l03327"></a>03327 <span class="preprocessor"></span>    rc = sqlite3_prepare16_v2(_db, 
<a name="l03328"></a>03328       reinterpret_cast&lt;const wchar_t*&gt;(cmd.c_str()), 
<a name="l03329"></a>03329       cmd.length()*<span class="keyword">sizeof</span>(wchar_t), 
<a name="l03330"></a>03330       &amp;_stm, 0);
<a name="l03331"></a>03331 <span class="preprocessor">#else</span>
<a name="l03332"></a>03332 <span class="preprocessor"></span>    rc = sqlite3_prepare_v2(_db, 
<a name="l03333"></a>03333       reinterpret_cast&lt;const char*&gt;(cmd.c_str()), 
<a name="l03334"></a>03334       cmd.length()*<span class="keyword">sizeof</span>(char), 
<a name="l03335"></a>03335       &amp;_stm, 0);
<a name="l03336"></a>03336 <span class="preprocessor">#endif // _UNICODE</span>
<a name="l03337"></a>03337 <span class="preprocessor"></span>
<a name="l03338"></a>03338     <span class="keywordflow">if</span> (rc != SQLITE_OK || _stm == 0) 
<a name="l03339"></a>03339     {
<a name="l03340"></a>03340       <span class="keywordflow">switch</span>(rc) 
<a name="l03341"></a>03341       {
<a name="l03342"></a>03342       <span class="keywordflow">case</span> SQLITE_BUSY: 
<a name="l03343"></a>03343       <span class="keywordflow">case</span> SQLITE_LOCKED: 
<a name="l03345"></a>03345 <span class="preprocessor">#if defined (WIN32) || defined (WIN64)</span>
<a name="l03346"></a>03346 <span class="preprocessor"></span>        Sleep(250); 
<a name="l03347"></a>03347 <span class="preprocessor">#else</span>
<a name="l03348"></a>03348 <span class="preprocessor"></span>                sleep(250); 
<a name="l03349"></a>03349 <span class="preprocessor">#endif</span>
<a name="l03350"></a>03350 <span class="preprocessor"></span>        <span class="keywordflow">break</span>;
<a name="l03351"></a>03351       <span class="keywordflow">default</span>: 
<a name="l03352"></a>03352         _base.<a class="code" href="classdb_1_1base.html#a66d992a19efa01b7d6d93a86fa31209a" title="throw_error">throw_error</a>(rc);
<a name="l03353"></a>03353       }
<a name="l03354"></a>03354     }
<a name="l03355"></a>03355     <span class="keywordflow">else</span>
<a name="l03356"></a>03356       <span class="keywordflow">break</span>;
<a name="l03357"></a>03357   } 
<a name="l03358"></a>03358 
<a name="l03359"></a>03359   <span class="keywordflow">if</span> (rc != SQLITE_OK || !_stm)
<a name="l03360"></a>03360     <span class="keywordflow">return</span>;
<a name="l03361"></a>03361 
<a name="l03362"></a>03362   <span class="keywordtype">unsigned</span> nRowCnt(0);
<a name="l03363"></a>03363   <span class="keywordflow">while</span> ((rc = sqlite3_step(_stm)) == SQLITE_ROW) 
<a name="l03364"></a>03364   {
<a name="l03365"></a>03365     <span class="keywordflow">if</span> (nRowCnt==0)
<a name="l03366"></a>03366     {
<a name="l03367"></a>03367       _field.reserve(sqlite3_column_count(_stm)); <span class="keywordtype">string</span> tmp;
<a name="l03368"></a>03368       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i(0), sz(sqlite3_column_count(_stm)); i &lt; sz; ++i)
<a name="l03369"></a>03369       {
<a name="l03370"></a>03370 <span class="preprocessor">#ifdef _UNICODE</span>
<a name="l03371"></a>03371 <span class="preprocessor"></span>        tmp = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">wchar_t</span>*<span class="keyword">&gt;</span>(
<a name="l03372"></a>03372           sqlite3_column_origin_name16(_stm, i));
<a name="l03373"></a>03373 <span class="preprocessor">#else</span>
<a name="l03374"></a>03374 <span class="preprocessor"></span>        tmp = sqlite3_column_origin_name(_stm, i);
<a name="l03375"></a>03375 <span class="preprocessor">#endif // _UNICODE</span>
<a name="l03376"></a>03376 <span class="preprocessor"></span>
<a name="l03377"></a>03377         _field.push_back(<a class="code" href="classdb_1_1field.html" title="fieldtype interface">db::field</a>(tmp));
<a name="l03378"></a>03378 
<a name="l03379"></a>03379         <span class="keywordflow">switch</span> (sqlite3_column_type(_stm, i))
<a name="l03380"></a>03380         {
<a name="l03381"></a>03381         <span class="keywordflow">case</span> SQLITE_NULL:
<a name="l03382"></a>03382           _field.back().set_type(db::e_null);
<a name="l03383"></a>03383           <span class="keywordflow">break</span>;
<a name="l03384"></a>03384         <span class="keywordflow">case</span> SQLITE_INTEGER:
<a name="l03385"></a>03385           _field.back().set_type(db::e_long);
<a name="l03386"></a>03386           <span class="keywordflow">break</span>;
<a name="l03387"></a>03387         <span class="keywordflow">case</span> SQLITE_FLOAT:
<a name="l03388"></a>03388           _field.back().set_type(db::e_double);
<a name="l03389"></a>03389           <span class="keywordflow">break</span>;
<a name="l03390"></a>03390         <span class="keywordflow">case</span> SQLITE_TEXT:
<a name="l03391"></a>03391           _field.back().set_type(db::e_string);
<a name="l03392"></a>03392           <span class="keywordflow">break</span>;
<a name="l03393"></a>03393         <span class="keywordflow">case</span> SQLITE_BLOB:
<a name="l03394"></a>03394           _field.back().set_type(db::e_blob);
<a name="l03395"></a>03395           <span class="keywordflow">break</span>;
<a name="l03396"></a>03396         <span class="keywordflow">default</span>:
<a name="l03397"></a>03397           _field.back().set_type(db::e_null);
<a name="l03398"></a>03398           <span class="keywordflow">break</span>;
<a name="l03399"></a>03399         }
<a name="l03400"></a>03400       }
<a name="l03401"></a>03401     }
<a name="l03402"></a>03402     
<a name="l03403"></a>03403     _data.push_back(<a class="code" href="classdb_1_1row.html" title="table rows interface">row</a>(<span class="keyword">this</span>, nRowCnt++));
<a name="l03404"></a>03404     _data.back().fill(_stm);
<a name="l03405"></a>03405   }
<a name="l03406"></a>03406   sqlite3_finalize(_stm);
<a name="l03407"></a>03407   _stm = 0; 
<a name="l03408"></a>03408 }
<a name="l03409"></a>03409 
<a name="l03410"></a>03410 <span class="keywordtype">void</span> db::detail::w2a::init(
<a name="l03411"></a>03411       <span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* psz
<a name="l03412"></a>03412     , <span class="keywordtype">unsigned</span> nConvertCodePage)
<a name="l03413"></a>03413 {
<a name="l03414"></a>03414     <span class="keywordflow">if</span> (psz == 0)
<a name="l03415"></a>03415     {
<a name="l03416"></a>03416         sz_.clear();
<a name="l03417"></a>03417         <span class="keywordflow">return</span>;
<a name="l03418"></a>03418     }
<a name="l03419"></a>03419 
<a name="l03420"></a>03420 <span class="preprocessor">#if defined (WIN32) || defined (WIN64)</span>
<a name="l03421"></a>03421 <span class="preprocessor"></span>    <span class="keywordtype">int</span> lenW(lstrlenW( psz )+1);         
<a name="l03422"></a>03422     <span class="keywordtype">int</span> lenA(lenW*4);
<a name="l03423"></a>03423 
<a name="l03424"></a>03424     sz_.resize(lenA);
<a name="l03425"></a>03425 
<a name="l03426"></a>03426     <span class="keywordtype">bool</span> failed(0 == ::WideCharToMultiByte( 
<a name="l03427"></a>03427           nConvertCodePage
<a name="l03428"></a>03428         , 0
<a name="l03429"></a>03429         , psz
<a name="l03430"></a>03430         , lenW
<a name="l03431"></a>03431         , &amp;*sz_.begin()
<a name="l03432"></a>03432         , lenA
<a name="l03433"></a>03433         , 0
<a name="l03434"></a>03434         , 0));
<a name="l03435"></a>03435 
<a name="l03436"></a>03436     <span class="keywordflow">if</span> (failed)
<a name="l03437"></a>03437     {
<a name="l03438"></a>03438         <span class="keywordflow">if</span> (GetLastError()==ERROR_INSUFFICIENT_BUFFER)
<a name="l03439"></a>03439         {
<a name="l03440"></a>03440             lenA = ::WideCharToMultiByte( 
<a name="l03441"></a>03441                 nConvertCodePage
<a name="l03442"></a>03442                 , 0
<a name="l03443"></a>03443                 , psz
<a name="l03444"></a>03444                 , lenW
<a name="l03445"></a>03445                 , 0
<a name="l03446"></a>03446                 , 0
<a name="l03447"></a>03447                 , 0
<a name="l03448"></a>03448                 , 0);
<a name="l03449"></a>03449 
<a name="l03450"></a>03450             sz_.resize(lenA);
<a name="l03451"></a>03451 
<a name="l03452"></a>03452             failed=(0 == ::WideCharToMultiByte(
<a name="l03453"></a>03453                 nConvertCodePage
<a name="l03454"></a>03454                 , 0
<a name="l03455"></a>03455                 , psz
<a name="l03456"></a>03456                 , lenW
<a name="l03457"></a>03457                 , &amp;*sz_.begin()
<a name="l03458"></a>03458                 , lenA
<a name="l03459"></a>03459                 , 0
<a name="l03460"></a>03460                 , 0));
<a name="l03461"></a>03461         }           
<a name="l03462"></a>03462     }
<a name="l03463"></a>03463 
<a name="l03464"></a>03464     <span class="keywordflow">if</span> (failed)
<a name="l03465"></a>03465     {
<a name="l03466"></a>03466         db::stringstream err;
<a name="l03467"></a>03467         err &lt;&lt; DB_TEXT(<span class="stringliteral">&quot;Lasterror was &quot;</span>) 
<a name="l03468"></a>03468             &lt;&lt; GetLastError() 
<a name="l03469"></a>03469             &lt;&lt; DB_TEXT(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03470"></a>03470         <span class="keywordflow">throw</span> db::exception::unknown_error(err.str());
<a name="l03471"></a>03471     }
<a name="l03472"></a>03472 <span class="preprocessor">#else</span>
<a name="l03473"></a>03473 <span class="preprocessor"></span>
<a name="l03474"></a>03474 <span class="preprocessor">#endif</span>
<a name="l03475"></a>03475 <span class="preprocessor"></span>}
<a name="l03476"></a>03476 
<a name="l03477"></a>03477 <span class="keyword">inline</span> <span class="keywordtype">void</span> db::detail::a2w::init(
<a name="l03478"></a>03478       <span class="keyword">const</span> <span class="keywordtype">char</span>* psz
<a name="l03479"></a>03479     , <span class="keywordtype">unsigned</span> nCodePage)
<a name="l03480"></a>03480 {
<a name="l03481"></a>03481     <span class="keywordflow">if</span> (psz == 0)
<a name="l03482"></a>03482     {
<a name="l03483"></a>03483         sz_.clear();
<a name="l03484"></a>03484         <span class="keywordflow">return</span>;
<a name="l03485"></a>03485     }
<a name="l03486"></a>03486 
<a name="l03487"></a>03487 <span class="preprocessor">#if defined (WIN32) || defined (WIN64)</span>
<a name="l03488"></a>03488 <span class="preprocessor"></span>    <span class="keywordtype">int</span> lenA(lstrlenA( psz )+1);         
<a name="l03489"></a>03489     <span class="keywordtype">int</span> lenW(lenA);
<a name="l03490"></a>03490 
<a name="l03491"></a>03491     sz_.resize(lenW);
<a name="l03492"></a>03492 
<a name="l03493"></a>03493     <span class="keywordtype">bool</span> failed(0 == ::MultiByteToWideChar(
<a name="l03494"></a>03494           nCodePage
<a name="l03495"></a>03495         , 0
<a name="l03496"></a>03496         , psz
<a name="l03497"></a>03497         , lenA
<a name="l03498"></a>03498         , &amp;*sz_.begin()
<a name="l03499"></a>03499         , lenW));
<a name="l03500"></a>03500 
<a name="l03501"></a>03501     <span class="keywordflow">if</span> (failed)
<a name="l03502"></a>03502     {
<a name="l03503"></a>03503         <span class="keywordflow">if</span> (GetLastError()==ERROR_INSUFFICIENT_BUFFER)
<a name="l03504"></a>03504         {
<a name="l03505"></a>03505             lenW = ::MultiByteToWideChar(
<a name="l03506"></a>03506                   nCodePage
<a name="l03507"></a>03507                 , 0
<a name="l03508"></a>03508                 , psz
<a name="l03509"></a>03509                 , lenA
<a name="l03510"></a>03510                 , 0
<a name="l03511"></a>03511                 , 0);
<a name="l03512"></a>03512 
<a name="l03513"></a>03513             sz_.resize(lenW);
<a name="l03514"></a>03514 
<a name="l03515"></a>03515             failed=(0 == ::MultiByteToWideChar(
<a name="l03516"></a>03516                   nCodePage
<a name="l03517"></a>03517                 , 0
<a name="l03518"></a>03518                 , psz
<a name="l03519"></a>03519                 , lenA
<a name="l03520"></a>03520                 , &amp;*sz_.begin()
<a name="l03521"></a>03521                 , lenW));
<a name="l03522"></a>03522         }           
<a name="l03523"></a>03523     }
<a name="l03524"></a>03524 
<a name="l03525"></a>03525     <span class="keywordflow">if</span> (failed)
<a name="l03526"></a>03526     {
<a name="l03527"></a>03527         db::stringstream err;
<a name="l03528"></a>03528         err &lt;&lt; DB_TEXT(<span class="stringliteral">&quot;Lasterror was &quot;</span>) 
<a name="l03529"></a>03529             &lt;&lt; GetLastError() 
<a name="l03530"></a>03530             &lt;&lt; DB_TEXT(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03531"></a>03531         <span class="keywordflow">throw</span> db::exception::unknown_error(err.str());
<a name="l03532"></a>03532     }
<a name="l03533"></a>03533 <span class="preprocessor">#else</span>
<a name="l03534"></a>03534 <span class="preprocessor"></span>
<a name="l03535"></a>03535 <span class="preprocessor">#endif</span>
<a name="l03536"></a>03536 <span class="preprocessor"></span>}
<a name="l03537"></a>03537 
<a name="l03538"></a>03538 <span class="preprocessor">#endif // db_h__</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Sat Mar 27 18:01:18 2010 for sqlite_wrapper by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
